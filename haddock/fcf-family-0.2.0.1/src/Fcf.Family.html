<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE
  AllowAmbiguousTypes,
  DataKinds,
  PolyKinds,
  RankNTypes,
  ScopedTypeVariables,
  StandaloneKindSignatures,
  TypeFamilies,
  TypeOperators,
  UndecidableInstances #-}</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- Description: The family of type families</span><span>
</span><span id="line-14"></span><span class="hs-comment">--</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- = The family of type families</span><span>
</span><span id="line-16"></span><span class="hs-comment">--</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- /fcf-family/ promotes</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- regular type families to first-class families without requiring new symbols</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- that pollute the type namespace nor a centralized organization to decide</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- where the symbol for each family should be defined.</span><span>
</span><span id="line-21"></span><span class="hs-comment">--</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- All we need is a single symbol 'Family' indexed by a qualified name that</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- uniquely identifies an existing type family: package, module, and base name.</span><span>
</span><span id="line-24"></span><span class="hs-comment">--</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- Example names:</span><span>
</span><span id="line-26"></span><span class="hs-comment">--</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- -- GHC.TypeNats.+</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- 'MkName' \&quot;base\&quot; \&quot;GHC.TypeNats\&quot; \&quot;+\&quot;</span><span>
</span><span id="line-30"></span><span class="hs-comment">--</span><span>
</span><span id="line-31"></span><span class="hs-comment">-- -- Data.Type.Bool.If</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- 'MkName' \&quot;base\&quot; \&quot;Data.Type.Bool\&quot; \&quot;If\&quot;</span><span>
</span><span id="line-33"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-34"></span><span class="hs-comment">--</span><span>
</span><span id="line-35"></span><span class="hs-comment">-- == Promoting a type family to first-class</span><span>
</span><span id="line-36"></span><span class="hs-comment">--</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- For example, the type family @('GHC.TypeNats.+')@ is promoted using the following</span><span>
</span><span id="line-38"></span><span class="hs-comment">-- 'Eval' instance for 'Family':</span><span>
</span><span id="line-39"></span><span class="hs-comment">--</span><span>
</span><span id="line-40"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-41"></span><span class="hs-comment">-- type (::+) = 'MkName' \&quot;base\&quot; \&quot;GHC.TypeNats\&quot; \&quot;+\&quot; -- 'Name' of (+)</span><span>
</span><span id="line-42"></span><span class="hs-comment">-- type instance 'Eval' ('Family_' (::+) _ '(x, '(y, '())))) = x 'GHC.TypeNats.+' y</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-44"></span><span class="hs-comment">--</span><span>
</span><span id="line-45"></span><span class="hs-comment">-- The necessary instances can be generated using 'Fcf.Family.TH.fcfify' from the</span><span>
</span><span id="line-46"></span><span class="hs-comment">-- module &quot;Fcf.Family.TH&quot;.</span><span>
</span><span id="line-47"></span><span class="hs-comment">--</span><span>
</span><span id="line-48"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- 'Fcf.Family.TH.fcfify' \'\'+</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-51"></span><span class="hs-comment">--</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- The name of the family can be quoted using 'Fcf.Family.TH.familyName'.</span><span>
</span><span id="line-53"></span><span class="hs-comment">--</span><span>
</span><span id="line-54"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-55"></span><span class="hs-comment">-- type (::+) = $(pure ('Fcf.Family.TH.familyName' \'\'+))</span><span>
</span><span id="line-56"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-57"></span><span class="hs-comment">--</span><span>
</span><span id="line-58"></span><span class="hs-comment">-- Two modules may invoke 'Fcf.Family.TH.fcfify' on the same name without conflict.</span><span>
</span><span id="line-59"></span><span class="hs-comment">-- Identical type family instances will be generated, which is allowed.</span><span>
</span><span id="line-60"></span><span class="hs-comment">--</span><span>
</span><span id="line-61"></span><span class="hs-comment">-- Examples:</span><span>
</span><span id="line-62"></span><span class="hs-comment">--</span><span>
</span><span id="line-63"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-64"></span><span class="hs-comment">-- 2 'GHC.TypeNats.+' 3</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- ~</span><span>
</span><span id="line-66"></span><span class="hs-comment">-- 'Eval' ('Family' ('MkName' \&quot;base\&quot; \&quot;GHC.TypeNats\&quot; \&quot;+\&quot;) 'P0' '(2, '(3, '())))</span><span>
</span><span id="line-67"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-68"></span><span class="hs-comment">--</span><span>
</span><span id="line-69"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-70"></span><span class="hs-comment">-- 'Data.Type.Bool.If' a b c</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- ~</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- 'Eval' ('Family' ('MkName' \&quot;base\&quot; \&quot;Data.Type.Bool\&quot; \&quot;If\&quot;) 'P1' '(a, '(b, '(c, \()))))</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-74"></span><span class="hs-comment">--</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- == Details</span><span>
</span><span id="line-76"></span><span class="hs-comment">--</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- The type of 'Family' is an uncurried version of the original type family:</span><span>
</span><span id="line-78"></span><span class="hs-comment">--</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- 'Family' (::+) _ :: (Nat, (Nat, ())) -&gt; Exp Nat</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- ('GHC.TypeNats.+') :: Nat -&gt; Nat -&gt; Nat</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-83"></span><span class="hs-comment">--</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- Tuples @(,)@ and @()@ are used as the cons and nil of heterogeneous lists of arguments.</span><span>
</span><span id="line-85"></span><span class="hs-comment">--</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- The signature of the relevant family is encoded by implementing the following</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- type instances:</span><span>
</span><span id="line-88"></span><span class="hs-comment">--</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- -- Auxiliary instances.</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- type instance 'Params' (::+) = ()</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- type instance 'Args_' (::+) _ = (Nat, (Nat, ()))</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- type instance 'Res_' (::+) _ _ = Nat</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-95"></span><span class="hs-comment">--</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- 'Args_' and 'Res_' denote the types of arguments and result of the given type family.</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- 'Params' denotes the type of implicit parameters (there are none here</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- since @('GHC.TypeNats.+')@ is monomorphic).</span><span>
</span><span id="line-99"></span><span class="hs-comment">-- The type of explicit arguments ('Args_') may depend on the implicit parameters ('Params').</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- The result type ('Res_') may depend on both 'Params' and 'Args_'.</span><span>
</span><span id="line-101"></span><span class="hs-comment">--</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- === Untyped inside, typed outside  #wrappers#</span><span>
</span><span id="line-103"></span><span class="hs-comment">--</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- These families are intended to be very dependent (the type of 'Family' depends on 'Res' depends on 'Args' depends on 'Params').</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- However, the implementation of this library must work around some technical limitations of GHC.</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- 'Args_' and 'Res_' are actually &quot;untyped&quot; to make GHC more lenient in type</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- checking their instances. \&quot;Typed\&quot; wrappers, 'Family', 'Res', 'Args' are</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- then provided to invoke those families with their intended types,</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- which allows type inference to work.</span><span>
</span><span id="line-110"></span><span class="hs-comment">--</span><span>
</span><span id="line-111"></span><span class="hs-comment">-- To recap: define instances of 'Params', 'Args_', 'Res_', 'Family_',</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- but to invoke the latter three, use 'Args', 'Res', and 'Family' instead.</span><span>
</span><span id="line-113"></span><span class="hs-comment">--</span><span>
</span><span id="line-114"></span><span class="hs-comment">-- == Implicit parameters</span><span>
</span><span id="line-115"></span><span class="hs-comment">--</span><span>
</span><span id="line-116"></span><span class="hs-comment">-- An example using implicit parameters is @'Data.Type.Bool.If' :: forall k. Bool -&gt; k -&gt; k -&gt; k@.</span><span>
</span><span id="line-117"></span><span class="hs-comment">--</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- type If_ = 'MkName' \&quot;base\&quot; \&quot;Data.Type.Bool\&quot; \&quot;If\&quot;</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- type instance 'Eval' ('Family_' If_ _ '(b, '(x, '(y, '())))) = 'Data.Type.Bool.If' b x y</span><span>
</span><span id="line-121"></span><span class="hs-comment">--</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- type instance 'Params' If_ = ('Data.Kind.Type', ())  -- Type of the implicit parameter</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- type instance 'Args_' If_ k = (Bool, (k, (k, ())      -- Types of the explicit arguments</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- type instance 'Res_' If_ k _ = k                      -- Type of the result</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-126"></span><span class="hs-comment">--</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- The second argument of 'Family_' is a proxy that carries the implicit parameters</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- in its type. For example, the type of @'Family' If_@ is really:</span><span>
</span><span id="line-129"></span><span class="hs-comment">--</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-131"></span><span class="hs-comment">-- 'Family' If_ (_ :: Proxy k) :: (Bool, (k, (k, ()))) -&gt; k</span><span>
</span><span id="line-132"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-133"></span><span class="hs-comment">--</span><span>
</span><span id="line-134"></span><span class="hs-comment">-- When using 'Family', apply it to a proxy encoding the number of implicit parameters</span><span>
</span><span id="line-135"></span><span class="hs-comment">-- in unary using 'P0' and 'PS'.</span><span>
</span><span id="line-136"></span><span class="hs-comment">--</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- For example, use 'P0' for the monomorphic @('GHC.TypeNats.+')@</span><span>
</span><span id="line-138"></span><span class="hs-comment">-- and 'P1' (equal to @'PS' 'P0'@) for 'Data.Type.Bool.If'.</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Fcf.Family</span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Main definitions</span></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** First-class families</span></span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><span class="hs-comment">-- $reexport</span></span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><span class="hs-identifier">Exp</span></span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Eval</span></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Family of families</span></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#Name"><span class="hs-identifier">Name</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#Family"><span class="hs-identifier">Family</span></a></span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#Family_"><span class="hs-identifier">Family_</span></a></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#NDFamily"><span class="hs-identifier">NDFamily</span></a></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#NDFamily_"><span class="hs-identifier">NDFamily_</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Encoding type family signatures</span></span><span>
</span><span id="line-156"></span><span>    </span><span class="annot"><span class="hs-comment">-- $arity</span></span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#Params"><span class="hs-identifier">Params</span></a></span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#Args"><span class="hs-identifier">Args</span></a></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#Args_"><span class="hs-identifier">Args_</span></a></span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#Res"><span class="hs-identifier">Res</span></a></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#Res_"><span class="hs-identifier">Res_</span></a></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Implicit parameters</span></span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><span class="hs-comment">-- $tuples</span></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#ParamsProxy"><span class="hs-identifier">ParamsProxy</span></a></span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#P0"><span class="hs-identifier">P0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#P1"><span class="hs-identifier">P1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#P2"><span class="hs-identifier">P2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#P3"><span class="hs-identifier">P3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#P4"><span class="hs-identifier">P4</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#P5"><span class="hs-identifier">P5</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#P6"><span class="hs-identifier">P6</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#P7"><span class="hs-identifier">P7</span></a></span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#PS"><span class="hs-identifier">PS</span></a></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Coercions</span></span><span>
</span><span id="line-170"></span><span>    </span><span class="annot"><span class="hs-comment">-- $hack</span></span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#Coerce"><span class="hs-identifier">Coerce</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#CoerceTo"><span class="hs-identifier">CoerceTo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#CoerceFrom"><span class="hs-identifier">CoerceFrom</span></a></span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Fcf.Family.html#Transp"><span class="hs-identifier">Transp</span></a></span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Proxy</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Type.Equality</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(:~:)</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Exts</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Any</span></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.TypeLits</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Fcf.Core</span></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="hs-comment">-- $reexport</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- Reexported from &lt;https://hackage.haskell.org/package/first-class-families first-class-families&gt;.</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="annot"><span class="hs-comment">-- | Qualified name of a type family or type synonym.</span></span><span>
</span><span id="line-187"></span><span class="hs-keyword">data</span><span> </span><span id="Name"><span class="annot"><a href="Fcf.Family.html#Name"><span class="hs-identifier hs-var">Name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MkName"><span class="annot"><a href="Fcf.Family.html#MkName"><span class="hs-identifier hs-var">MkName</span></a></span></span><span>
</span><span id="line-188"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Package name</span></span><span>
</span><span id="line-189"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Module name</span></span><span>
</span><span id="line-190"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Type name</span></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-comment">-- | A general defunctionalization symbol for promoted type families.</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- It encodes saturated applications of type families.</span><span>
</span><span id="line-194"></span><span class="hs-comment">--</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- The second argument (@proxy :: 'ParamsProxy' name ks@) is a gadget</span><span>
</span><span id="line-196"></span><span class="hs-comment">-- carrying implicit parameters (if any). When invoking 'Family', it must be applied to</span><span>
</span><span id="line-197"></span><span class="hs-comment">-- a @proxy@ that corresponds to its number of implicit parameters:</span><span>
</span><span id="line-198"></span><span class="hs-comment">-- 'P0', 'P1', 'P2', ..., 'P7', or a unary encoding using 'P0' and 'PS' for larger implicit arities.</span><span>
</span><span id="line-199"></span><span class="hs-comment">-- (This really matters for arity 2 and more.)</span><span>
</span><span id="line-200"></span><span class="hs-comment">--</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- === __Implementation note__</span><span>
</span><span id="line-202"></span><span class="hs-comment">--</span><span>
</span><span id="line-203"></span><span class="hs-comment">-- This module makes heavy use of dependently typed type families.</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- There is &lt;https://gitlab.haskell.org/ghc/ghc/-/issues/12088 a longstanding issue&gt;</span><span>
</span><span id="line-205"></span><span class="hs-comment">-- which severely limits the usability of such families when done naively.</span><span>
</span><span id="line-206"></span><span class="hs-comment">--</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- The workaround used here is to make the type families themselves &quot;untyped&quot;,</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- and wrap them within &quot;typed&quot; synonyms.</span><span>
</span><span id="line-209"></span><span class="hs-comment">--</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- Making the families untyped makes GHC more lenient so that it accepts them.</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- Making the wrappers typed recovers the type inference behavior of the original family.</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- For instance, when using 'Data.Type.Bool.If', one would expect to unify</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- the types of its two branches. That is the case when constructing its</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- defunctionalization symbol using 'Family' and not with 'Family_'.</span><span>
</span><span id="line-215"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="Fcf.Family.html#Family"><span class="hs-identifier hs-type">Family</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067021"><span class="annot"><a href="#local-6989586621679067021"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Fcf.Family.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067022"><span class="annot"><a href="#local-6989586621679067022"><span class="hs-identifier hs-type">ks</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Fcf.Family.html#Params"><span class="hs-identifier hs-type">Params</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067021"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Fcf.Family.html#ParamsProxy"><span class="hs-identifier hs-type">ParamsProxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067021"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067022"><span class="hs-identifier hs-type">ks</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067023"><span class="annot"><a href="#local-6989586621679067023"><span class="hs-identifier hs-type">args</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Fcf.Family.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067021"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067022"><span class="hs-identifier hs-type">ks</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Fcf.Family.html#Res"><span class="hs-identifier hs-type">Res</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067021"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067022"><span class="hs-identifier hs-type">ks</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067023"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span class="hs-keyword">type</span><span> </span><span id="Family"><span class="annot"><a href="Fcf.Family.html#Family"><span class="hs-identifier hs-var">Family</span></a></span></span><span> </span><span id="local-6989586621679067024"><span class="annot"><a href="#local-6989586621679067024"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621679067025"><span class="annot"><a href="#local-6989586621679067025"><span class="hs-identifier hs-type">proxy</span></a></span></span><span> </span><span id="local-6989586621679067026"><span class="annot"><a href="#local-6989586621679067026"><span class="hs-identifier hs-type">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Fcf.Family.html#Family_"><span class="hs-identifier hs-type">Family_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067024"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067025"><span class="hs-identifier hs-type">proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067026"><span class="hs-identifier hs-type">args</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="annot"><span class="hs-comment">-- | Non-dependently typed family.</span></span><span>
</span><span id="line-219"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="Fcf.Family.html#NDFamily"><span class="hs-identifier hs-type">NDFamily</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067027"><span class="annot"><a href="#local-6989586621679067027"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Fcf.Family.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067028"><span class="annot"><a href="#local-6989586621679067028"><span class="hs-identifier hs-type">ks</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Fcf.Family.html#Params"><span class="hs-identifier hs-type">Params</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067027"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Fcf.Family.html#ParamsProxy"><span class="hs-identifier hs-type">ParamsProxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067027"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067028"><span class="hs-identifier hs-type">ks</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Fcf.Family.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067027"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067028"><span class="hs-identifier hs-type">ks</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Fcf.Family.html#Res"><span class="hs-identifier hs-type">Res</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067027"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067028"><span class="hs-identifier hs-type">ks</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Any</span></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span class="hs-keyword">type</span><span> </span><span id="NDFamily"><span class="annot"><a href="Fcf.Family.html#NDFamily"><span class="hs-identifier hs-var">NDFamily</span></a></span></span><span> </span><span id="local-6989586621679067029"><span class="annot"><a href="#local-6989586621679067029"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621679067030"><span class="annot"><a href="#local-6989586621679067030"><span class="hs-identifier hs-type">proxy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Fcf.Family.html#NDFamily_"><span class="hs-identifier hs-type">NDFamily_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067029"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067030"><span class="hs-identifier hs-type">proxy</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Refl</span></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span class="annot"><span class="hs-comment">-- | Untyped internals of 'NDFamily'.</span></span><span>
</span><span id="line-223"></span><span class="hs-keyword">data</span><span> </span><span id="NDFamily_"><span class="annot"><a href="Fcf.Family.html#NDFamily_"><span class="hs-identifier hs-var">NDFamily_</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067032"><span class="annot"><a href="#local-6989586621679067032"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Fcf.Family.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067033"><span class="annot"><a href="#local-6989586621679067033"><span class="hs-identifier hs-type">ks</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Fcf.Family.html#Params"><span class="hs-identifier hs-type">Params</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067032"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Fcf.Family.html#ParamsProxy"><span class="hs-identifier hs-type">ParamsProxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067032"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067033"><span class="hs-identifier hs-type">ks</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Fcf.Family.html#Res"><span class="hs-identifier hs-type">Res</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067032"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067033"><span class="hs-identifier hs-type">ks</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Any</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:~:</span></span><span> </span><span class="annot"><a href="#local-6989586621679067034"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Fcf.Family.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067032"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067033"><span class="hs-identifier hs-type">ks</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span> </span><span class="annot"><a href="#local-6989586621679067034"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-224"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="Eval"><span class="annot"><span class="hs-identifier hs-var">Eval</span></span></span><span> </span><span id="local-6989586621679067035"><span id="local-6989586621679067036"><span id="local-6989586621679067037"><span id="local-6989586621679067038"><span class="hs-special">(</span><span class="annot"><a href="Fcf.Family.html#NDFamily_"><span class="hs-identifier hs-type">NDFamily_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067035"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067036"><span class="hs-identifier hs-type">proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067037"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067038"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Fcf.Family.html#Transp"><span class="hs-identifier hs-type">Transp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067037"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eval</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Fcf.Family.html#Coerce"><span class="hs-identifier hs-type">Coerce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Fcf.Family.html#Family"><span class="hs-identifier hs-type">Family</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067035"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067036"><span class="hs-identifier hs-type">proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067038"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="annot"><span class="hs-comment">-- | Untyped internals of 'Family'</span></span><span>
</span><span id="line-227"></span><span class="hs-keyword">data</span><span> </span><span id="Family_"><span class="annot"><a href="Fcf.Family.html#Family_"><span class="hs-identifier hs-var">Family_</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Fcf.Family.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679067039"><span class="hs-identifier hs-type">ks</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067040"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span> </span><span class="annot"><a href="#local-6989586621679067041"><span class="hs-identifier hs-type">res</span></a></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="hs-comment">-- $arity</span><span>
</span><span id="line-230"></span><span class="hs-comment">-- Parameters should be collected in a heterogeneous list made of @()@ and @(,)@.</span><span>
</span><span id="line-231"></span><span class="hs-comment">--</span><span>
</span><span id="line-232"></span><span class="hs-comment">-- - 0: @()@</span><span>
</span><span id="line-233"></span><span class="hs-comment">-- - 1: @(a, ())@</span><span>
</span><span id="line-234"></span><span class="hs-comment">-- - 2: @(a, (b, ()))@</span><span>
</span><span id="line-235"></span><span class="hs-comment">-- - 3: @(a, (b, (c, ())))@</span><span>
</span><span id="line-236"></span><span class="hs-comment">-- - etc.</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span class="annot"><span class="hs-comment">-- | Type of implicit parameters of the named family.</span></span><span>
</span><span id="line-239"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="Params"><span class="annot"><a href="Fcf.Family.html#Params"><span class="hs-identifier hs-var">Params</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067042"><span class="annot"><a href="#local-6989586621679067042"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Fcf.Family.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="annot"><span class="hs-comment">-- | Type of explicit parameters of the named family.</span></span><span>
</span><span id="line-242"></span><span class="hs-keyword">type</span><span> </span><span id="Args"><span class="annot"><a href="Fcf.Family.html#Args"><span class="hs-identifier hs-var">Args</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067043"><span class="annot"><a href="#local-6989586621679067043"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Fcf.Family.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067044"><span class="annot"><a href="#local-6989586621679067044"><span class="hs-identifier hs-type">ks</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Fcf.Family.html#Params"><span class="hs-identifier hs-type">Params</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067043"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Fcf.Family.html#Args_"><span class="hs-identifier hs-type">Args_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067043"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067044"><span class="hs-identifier hs-type">ks</span></a></span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="annot"><span class="hs-comment">-- | Untyped internals of 'Args'</span></span><span>
</span><span id="line-245"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="Args_"><span class="annot"><a href="Fcf.Family.html#Args_"><span class="hs-identifier hs-var">Args_</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067045"><span class="annot"><a href="#local-6989586621679067045"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Fcf.Family.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067046"><span class="annot"><a href="#local-6989586621679067046"><span class="hs-identifier hs-type">ks</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679067047"><span class="hs-identifier hs-type">ksT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="annot"><span class="hs-comment">-- | Type of result of the named family.</span></span><span>
</span><span id="line-248"></span><span class="hs-keyword">type</span><span> </span><span id="Res"><span class="annot"><a href="Fcf.Family.html#Res"><span class="hs-identifier hs-var">Res</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067048"><span class="annot"><a href="#local-6989586621679067048"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Fcf.Family.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067049"><span class="annot"><a href="#local-6989586621679067049"><span class="hs-identifier hs-type">ks</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Fcf.Family.html#Params"><span class="hs-identifier hs-type">Params</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067048"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067050"><span class="annot"><a href="#local-6989586621679067050"><span class="hs-identifier hs-type">args</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Fcf.Family.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067048"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067049"><span class="hs-identifier hs-type">ks</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Fcf.Family.html#Res_"><span class="hs-identifier hs-type">Res_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067048"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067049"><span class="hs-identifier hs-type">ks</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067050"><span class="hs-identifier hs-type">args</span></a></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span class="annot"><span class="hs-comment">-- | Untyped internals of 'Res'</span></span><span>
</span><span id="line-251"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="Res_"><span class="annot"><a href="Fcf.Family.html#Res_"><span class="hs-identifier hs-var">Res_</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067051"><span class="annot"><a href="#local-6989586621679067051"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Fcf.Family.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span id="local-6989586621679067052"><span id="local-6989586621679067053"><span> </span><span class="hs-special">(</span><span id="local-6989586621679067054"><span class="annot"><a href="#local-6989586621679067054"><span class="hs-identifier hs-type">ks</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679067052"><span class="hs-identifier hs-type">ksT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">args</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">argsT</span></span></span><span id="local-6989586621679067052"><span id="local-6989586621679067053"></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="annot"><span class="hs-comment">-- * Implicit parameters</span></span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span class="hs-comment">-- $tuples</span><span>
</span><span id="line-256"></span><span class="hs-comment">-- We want implicit parameters of polykinded type families to remain implicit</span><span>
</span><span id="line-257"></span><span class="hs-comment">-- in their promotion.</span><span>
</span><span id="line-258"></span><span class="hs-comment">--</span><span>
</span><span id="line-259"></span><span class="hs-comment">-- In 'Family', the parameters are collected in a tuple. To help type inference</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- when using a promoted type family, we instantiate the spine of the tuple</span><span>
</span><span id="line-261"></span><span class="hs-comment">-- using the following proxies.</span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span class="hs-comment">-- | Synonym to make explicit the dependency of the type of the</span><span>
</span><span id="line-264"></span><span class="hs-comment">-- implicit parameters @ks@ on the @name@ of the family.</span><span>
</span><span id="line-265"></span><span class="hs-keyword">type</span><span> </span><span id="ParamsProxy"><span class="annot"><a href="Fcf.Family.html#ParamsProxy"><span class="hs-identifier hs-var">ParamsProxy</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067055"><span class="annot"><a href="#local-6989586621679067055"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Fcf.Family.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067056"><span class="annot"><a href="#local-6989586621679067056"><span class="hs-identifier hs-type">ks</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Fcf.Family.html#Params"><span class="hs-identifier hs-type">Params</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067055"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679067056"><span class="hs-identifier hs-type">ks</span></a></span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="hs-keyword">type</span><span> </span><span id="P0"><span class="annot"><a href="Fcf.Family.html#P0"><span class="hs-identifier hs-var">P0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span class="hs-keyword">type</span><span> </span><span id="P1"><span class="annot"><a href="Fcf.Family.html#P1"><span class="hs-identifier hs-var">P1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Fcf.Family.html#PS"><span class="hs-identifier hs-type">PS</span></a></span><span> </span><span class="annot"><a href="Fcf.Family.html#P0"><span class="hs-identifier hs-type">P0</span></a></span><span>
</span><span id="line-269"></span><span class="hs-keyword">type</span><span> </span><span id="P2"><span class="annot"><a href="Fcf.Family.html#P2"><span class="hs-identifier hs-var">P2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Fcf.Family.html#PS"><span class="hs-identifier hs-type">PS</span></a></span><span> </span><span class="annot"><a href="Fcf.Family.html#P1"><span class="hs-identifier hs-type">P1</span></a></span><span>
</span><span id="line-270"></span><span class="hs-keyword">type</span><span> </span><span id="P3"><span class="annot"><a href="Fcf.Family.html#P3"><span class="hs-identifier hs-var">P3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Fcf.Family.html#PS"><span class="hs-identifier hs-type">PS</span></a></span><span> </span><span class="annot"><a href="Fcf.Family.html#P2"><span class="hs-identifier hs-type">P2</span></a></span><span>
</span><span id="line-271"></span><span class="hs-keyword">type</span><span> </span><span id="P4"><span class="annot"><a href="Fcf.Family.html#P4"><span class="hs-identifier hs-var">P4</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Fcf.Family.html#PS"><span class="hs-identifier hs-type">PS</span></a></span><span> </span><span class="annot"><a href="Fcf.Family.html#P3"><span class="hs-identifier hs-type">P3</span></a></span><span>
</span><span id="line-272"></span><span class="hs-keyword">type</span><span> </span><span id="P5"><span class="annot"><a href="Fcf.Family.html#P5"><span class="hs-identifier hs-var">P5</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Fcf.Family.html#PS"><span class="hs-identifier hs-type">PS</span></a></span><span> </span><span class="annot"><a href="Fcf.Family.html#P4"><span class="hs-identifier hs-type">P4</span></a></span><span>
</span><span id="line-273"></span><span class="hs-keyword">type</span><span> </span><span id="P6"><span class="annot"><a href="Fcf.Family.html#P6"><span class="hs-identifier hs-var">P6</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Fcf.Family.html#PS"><span class="hs-identifier hs-type">PS</span></a></span><span> </span><span class="annot"><a href="Fcf.Family.html#P5"><span class="hs-identifier hs-type">P5</span></a></span><span>
</span><span id="line-274"></span><span class="hs-keyword">type</span><span> </span><span id="P7"><span class="annot"><a href="Fcf.Family.html#P7"><span class="hs-identifier hs-var">P7</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Fcf.Family.html#PS"><span class="hs-identifier hs-type">PS</span></a></span><span> </span><span class="annot"><a href="Fcf.Family.html#P6"><span class="hs-identifier hs-type">P6</span></a></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="hs-keyword">type</span><span> </span><span id="PS"><span class="annot"><a href="Fcf.Family.html#PS"><span class="hs-identifier hs-var">PS</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067058"><span class="annot"><a href="#local-6989586621679067058"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679067059"><span class="hs-identifier hs-type">ks</span></a></span><span class="hs-special">)</span><span id="local-6989586621679067059"><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Proxy</span><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-identifier">k</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ks</span></span><span id="local-6989586621679067059"></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="annot"><span class="hs-comment">-- * Coercions</span></span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span class="annot"><span class="hs-comment">-- $hack These coercions are part of hacks to work around some limitations in GHC.</span></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="hs-comment">-- | Sometimes GHC doesn't see that two type-level values are equal when they</span><span>
</span><span id="line-283"></span><span class="hs-comment">-- ought to be equal. 'Coerce' lets us postpone the check to another day.</span><span>
</span><span id="line-284"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="Fcf.Family.html#Coerce"><span class="hs-identifier hs-type">Coerce</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679067060"><span class="annot"><a href="#local-6989586621679067060"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621679067061"><span class="annot"><a href="#local-6989586621679067061"><span class="hs-identifier hs-type">l</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679067060"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067061"><span class="hs-identifier hs-type">l</span></a></span><span>
</span><span id="line-285"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="Coerce"><span class="annot"><a href="Fcf.Family.html#Coerce"><span class="hs-identifier hs-var">Coerce</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067062"><span class="annot"><a href="#local-6989586621679067062"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679067063"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679067064"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-286"></span><span>  </span><span id="Coerce"><span class="annot"><a href="Fcf.Family.html#Coerce"><span class="hs-identifier hs-var">Coerce</span></a></span></span><span> </span><span id="local-6989586621679067065"><span class="annot"><a href="#local-6989586621679067065"><span class="hs-identifier hs-type hs-type">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679067065"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span class="annot"><span class="hs-comment">-- | 'Coerce' with explicit codomain.</span></span><span>
</span><span id="line-289"></span><span class="hs-keyword">type</span><span> </span><span id="CoerceTo"><span class="annot"><a href="Fcf.Family.html#CoerceTo"><span class="hs-identifier hs-var">CoerceTo</span></a></span></span><span> </span><span id="local-6989586621679067066"><span id="local-6989586621679067067"><span class="annot"><a href="#local-6989586621679067067"><span class="hs-identifier hs-type">l</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067068"><span class="annot"><a href="#local-6989586621679067068"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679067066"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Coerce</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679067067"><span class="hs-identifier hs-type">l</span></a></span></span><span id="local-6989586621679067066"></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span class="annot"><span class="hs-comment">-- | 'Coerce' with explicit domain.</span></span><span>
</span><span id="line-292"></span><span class="hs-keyword">type</span><span> </span><span id="CoerceFrom"><span class="annot"><a href="Fcf.Family.html#CoerceFrom"><span class="hs-identifier hs-var">CoerceFrom</span></a></span></span><span> </span><span id="local-6989586621679067069"><span class="annot"><a href="#local-6989586621679067069"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067070"><span class="annot"><a href="#local-6989586621679067070"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679067069"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Fcf.Family.html#Coerce"><span class="hs-identifier hs-type">Coerce</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067070"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span class="annot"><span class="hs-comment">-- | Transport: coercion along an equality.</span></span><span>
</span><span id="line-295"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="Fcf.Family.html#Transp"><span class="hs-identifier hs-type">Transp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679067071"><span class="annot"><a href="#local-6989586621679067071"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621679067072"><span class="annot"><a href="#local-6989586621679067072"><span class="hs-identifier hs-type">l</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679067071"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:~:</span></span><span> </span><span class="annot"><a href="#local-6989586621679067072"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067071"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067072"><span class="hs-identifier hs-type">l</span></a></span><span>
</span><span id="line-296"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="Transp"><span class="annot"><a href="Fcf.Family.html#Transp"><span class="hs-identifier hs-var">Transp</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679067073"><span class="annot"><a href="#local-6989586621679067073"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679067074"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:~:</span></span><span> </span><span class="annot"><a href="#local-6989586621679067075"><span class="hs-identifier hs-type">l</span></a></span><span class="hs-special">)</span><span id="local-6989586621679067074"><span id="local-6989586621679067075"><span> </span><span class="hs-special">(</span><span id="local-6989586621679067076"><span class="annot"><a href="#local-6989586621679067076"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679067074"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679067075"><span class="hs-identifier hs-type">l</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-297"></span><span>  </span><span id="Transp"><span class="annot"><a href="Fcf.Family.html#Transp"><span class="hs-identifier hs-var">Transp</span></a></span></span><span> </span><span id="local-6989586621679067077"><span id="local-6989586621679067078"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679067077"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:~:</span></span><span> </span><span class="annot"><a href="#local-6989586621679067077"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679067078"><span class="hs-identifier hs-type">x</span></a></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679067078"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-298"></span></pre></body></html>