<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE KindSignatures        #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Control.Monad.Foil.Relative</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Control.Monad.Foil.html"><span class="hs-identifier">Control.Monad.Foil</span></a></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="annot"><span class="hs-comment">-- | Relative monads, restricted to types indexed by scopes in kind 'S'.</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">class</span><span> </span><span id="RelMonad"><span class="annot"><a href="Control.Monad.Foil.Relative.html#RelMonad"><span class="hs-identifier hs-var">RelMonad</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679177963"><span class="annot"><a href="#local-6989586621679177963"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.Monad.Foil.Internal.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679177964"><span class="annot"><a href="#local-6989586621679177964"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.Monad.Foil.Internal.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-comment">-- | Relative version of 'return'.</span><span>
</span><span id="line-11"></span><span>  </span><span id="rreturn"><span class="annot"><a href="Control.Monad.Foil.Relative.html#rreturn"><span class="hs-identifier hs-type">rreturn</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679177965"><span class="annot"><a href="#local-6989586621679177963"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679177965"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679177964"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679177965"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-comment">-- | Relative version of '&gt;&gt;='.</span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-comment">-- Note the two special additions to the usual definition of a relative binding operation:</span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-comment">-- 1. @'Scope' b@ is added since is corresponds to the runtime counterpart of the type parameter @b@.</span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-comment">-- 2. @t'Distinct' b@ constraint helps to ensure we only work with scopes that are distinct.</span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-comment">-- Technically, it is also possible add similar components for @a@ parameter.</span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-comment">-- Also, we could probably treat types in 'S' as singletons and extract distinct scopes that way,</span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-comment">-- preserving the more general type signature for 'rbind'.</span><span>
</span><span id="line-23"></span><span>  </span><span id="rbind"><span class="annot"><a href="Control.Monad.Foil.Relative.html#rbind"><span class="hs-identifier hs-type">rbind</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679177961"><span id="local-6989586621679177962"><span class="annot"><a href="Control.Monad.Foil.Internal.html#Distinct"><span class="hs-identifier hs-type">Distinct</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679177961"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Foil.Internal.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679177961"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679177964"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679177962"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679177963"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679177962"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679177964"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679177961"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679177964"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679177961"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="annot"><span class="hs-comment">-- | Relative version of 'liftM' (an 'fmap' restricted to 'Monad').</span></span><span>
</span><span id="line-26"></span><span id="local-6989586621679177950"><span id="local-6989586621679177951"><span id="local-6989586621679177953"><span id="local-6989586621679177956"><span class="annot"><a href="Control.Monad.Foil.Relative.html#liftRM"><span class="hs-identifier hs-type">liftRM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Foil.Relative.html#RelMonad"><span class="hs-identifier hs-type">RelMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679177950"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679177951"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Monad.Foil.Internal.html#Distinct"><span class="hs-identifier hs-type">Distinct</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679177953"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Foil.Internal.html#Scope"><span class="hs-identifier hs-type">Scope</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679177953"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679177950"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679177956"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679177950"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679177953"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679177951"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679177956"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679177951"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679177953"><span class="hs-identifier hs-type">b</span></a></span></span></span></span></span><span>
</span><span id="line-27"></span><span id="liftRM"><span class="annot"><span class="annottext">liftRM :: forall (f :: S -&gt; *) (m :: S -&gt; *) (b :: S) (a :: S).
(RelMonad f m, Distinct b) =&gt;
Scope b -&gt; (f a -&gt; f b) -&gt; m a -&gt; m b
</span><a href="Control.Monad.Foil.Relative.html#liftRM"><span class="hs-identifier hs-var hs-var">liftRM</span></a></span></span><span> </span><span id="local-6989586621679177977"><span class="annot"><span class="annottext">Scope b
</span><a href="#local-6989586621679177977"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span id="local-6989586621679177978"><span class="annot"><span class="annottext">f a -&gt; f b
</span><a href="#local-6989586621679177978"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679177979"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679177979"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scope b -&gt; m a -&gt; (f a -&gt; m b) -&gt; m b
forall (b :: S) (a :: S).
Distinct b =&gt;
Scope b -&gt; m a -&gt; (f a -&gt; m b) -&gt; m b
forall (f :: S -&gt; *) (m :: S -&gt; *) (b :: S) (a :: S).
(RelMonad f m, Distinct b) =&gt;
Scope b -&gt; m a -&gt; (f a -&gt; m b) -&gt; m b
</span><a href="Control.Monad.Foil.Relative.html#rbind"><span class="hs-identifier hs-var">rbind</span></a></span><span> </span><span class="annot"><span class="annottext">Scope b
</span><a href="#local-6989586621679177977"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679177979"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f b -&gt; m b
forall (a :: S). f a -&gt; m a
forall (f :: S -&gt; *) (m :: S -&gt; *) (a :: S).
RelMonad f m =&gt;
f a -&gt; m a
</span><a href="Control.Monad.Foil.Relative.html#rreturn"><span class="hs-identifier hs-var">rreturn</span></a></span><span> </span><span class="annot"><span class="annottext">(f b -&gt; m b) -&gt; (f a -&gt; f b) -&gt; f a -&gt; m b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">f a -&gt; f b
</span><a href="#local-6989586621679177978"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span></pre></body></html>