<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_GHC -Wno-orphans -Wno-redundant-constraints #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds         #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts         #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables         #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies         #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric         #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving         #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE DeriveTraversable #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE GADTs             #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE KindSignatures    #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase        #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE PatternSynonyms   #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes        #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell   #-}</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- | Functions over Second-Order Abstract Syntax (SOAS)</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- represented using scope-safe Haskell types (via Free Foil).</span><span>
</span><span id="line-18"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.SOAS.Impl</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">find</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Foil</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Foil</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Free.Foil</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.SOAS.Impl.Generated.html"><span class="hs-identifier">Language.SOAS.Impl.Generated</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Language.SOAS.Syntax.Abs.html"><span class="hs-identifier">Language.SOAS.Syntax.Abs</span></a></span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Raw</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Language.SOAS.Syntax.Lex.html"><span class="hs-identifier">Language.SOAS.Syntax.Lex</span></a></span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Raw</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Language.SOAS.Syntax.Par.html"><span class="hs-identifier">Language.SOAS.Syntax.Par</span></a></span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Raw</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Language.SOAS.Syntax.Print.html"><span class="hs-identifier">Language.SOAS.Syntax.Print</span></a></span><span>  </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Raw</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.Exit</span></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">exitFailure</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-comment">-- $setup</span><span>
</span><span id="line-33"></span><span class="hs-comment">-- &gt;&gt;&gt; :set -XOverloadedStrings</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- &gt;&gt;&gt; :set -XDataKinds</span><span>
</span><span id="line-35"></span><span class="hs-comment">-- &gt;&gt;&gt; import qualified Control.Monad.Foil as Foil</span><span>
</span><span id="line-36"></span><span class="hs-comment">-- &gt;&gt;&gt; import Control.Monad.Free.Foil</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- &gt;&gt;&gt; import Data.String (fromString)</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="annot"><span class="hs-comment">-- * Standard Types</span></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="annot"><span class="hs-comment">-- | Standard terms with source code location annotations.</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">type</span><span> </span><span id="Term"><span class="annot"><a href="Language.SOAS.Impl.html#Term"><span class="hs-identifier hs-var">Term</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.SOAS.Impl.Generated.html#Term%27"><span class="hs-identifier hs-type">Term'</span></a></span><span> </span><span class="annot"><a href="Language.SOAS.Syntax.Abs.html#BNFC%27Position"><span class="hs-identifier hs-type">Raw.BNFC'Position</span></a></span><span>
</span><span id="line-43"></span><span class="annot"><span class="hs-comment">-- | Standard types with source code location annotations.</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">type</span><span> </span><span id="Type"><span class="annot"><a href="Language.SOAS.Impl.html#Type"><span class="hs-identifier hs-var">Type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.SOAS.Impl.Generated.html#Type%27"><span class="hs-identifier hs-type">Type'</span></a></span><span> </span><span class="annot"><a href="Language.SOAS.Syntax.Abs.html#BNFC%27Position"><span class="hs-identifier hs-type">Raw.BNFC'Position</span></a></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="annot"><span class="hs-comment">-- | Standard metavariable substitutions with source code location annotations.</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">type</span><span> </span><span id="Subst"><span class="annot"><a href="Language.SOAS.Impl.html#Subst"><span class="hs-identifier hs-var">Subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.SOAS.Impl.Generated.html#Subst%27"><span class="hs-identifier hs-type">Subst'</span></a></span><span> </span><span class="annot"><a href="Language.SOAS.Syntax.Abs.html#BNFC%27Position"><span class="hs-identifier hs-type">Raw.BNFC'Position</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foil.VoidS</span></span><span>
</span><span id="line-48"></span><span class="annot"><span class="hs-comment">-- | Standard unification constraints with source code location annotations.</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">type</span><span> </span><span id="Constraint"><span class="annot"><a href="Language.SOAS.Impl.html#Constraint"><span class="hs-identifier hs-var">Constraint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.SOAS.Impl.Generated.html#Constraint%27"><span class="hs-identifier hs-type">Constraint'</span></a></span><span> </span><span class="annot"><a href="Language.SOAS.Syntax.Abs.html#BNFC%27Position"><span class="hs-identifier hs-type">Raw.BNFC'Position</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foil.VoidS</span></span><span>
</span><span id="line-50"></span><span class="annot"><span class="hs-comment">-- | Standard operator typings with source code location annotations.</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">type</span><span> </span><span id="OpTyping"><span class="annot"><a href="Language.SOAS.Impl.html#OpTyping"><span class="hs-identifier hs-var">OpTyping</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.SOAS.Impl.Generated.html#OpTyping%27"><span class="hs-identifier hs-type">OpTyping'</span></a></span><span> </span><span class="annot"><a href="Language.SOAS.Syntax.Abs.html#BNFC%27Position"><span class="hs-identifier hs-type">Raw.BNFC'Position</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foil.VoidS</span></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="annot"><span class="hs-comment">-- * Metavariable substitutions</span></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-comment">-- | Lookup a substitution by its 'Raw.MetaVarIdent'.</span><span>
</span><span id="line-56"></span><span class="hs-comment">--</span><span>
</span><span id="line-57"></span><span class="hs-comment">-- &gt;&gt;&gt; lookupSubst &quot;?m&quot; [&quot;?n[] &#8614; Zero()&quot;, &quot;?m[x y] &#8614; App(y, x)&quot;]</span><span>
</span><span id="line-58"></span><span class="hs-comment">-- Just ?m [x0 x1] &#8614; App (x1, x0)</span><span>
</span><span id="line-59"></span><span class="annot"><a href="Language.SOAS.Impl.html#lookupSubst"><span class="hs-identifier hs-type">lookupSubst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.SOAS.Syntax.Abs.html#MetaVarIdent"><span class="hs-identifier hs-type">Raw.MetaVarIdent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.SOAS.Impl.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Language.SOAS.Impl.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span>
</span><span id="line-60"></span><span id="lookupSubst"><span class="annot"><span class="annottext">lookupSubst :: MetaVarIdent -&gt; [Subst] -&gt; Maybe Subst
</span><a href="Language.SOAS.Impl.html#lookupSubst"><span class="hs-identifier hs-var hs-var">lookupSubst</span></a></span></span><span> </span><span id="local-6989586621679448322"><span class="annot"><span class="annottext">MetaVarIdent
</span><a href="#local-6989586621679448322"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Subst -&gt; Bool) -&gt; [Subst] -&gt; Maybe Subst
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="annot"><span class="annottext">((Subst -&gt; Bool) -&gt; [Subst] -&gt; Maybe Subst)
-&gt; (Subst -&gt; Bool) -&gt; [Subst] -&gt; Maybe Subst
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Language.SOAS.Impl.Generated.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span id="local-6989586621679448326"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679448326"><span class="hs-identifier hs-var">_loc</span></a></span></span><span> </span><span id="local-6989586621679448327"><span class="annot"><span class="annottext">MetaVarIdent
</span><a href="#local-6989586621679448327"><span class="hs-identifier hs-var">m'</span></a></span></span><span> </span><span class="annot"><span class="annottext">Binders' BNFC'Position 'VoidS i
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term' BNFC'Position i
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetaVarIdent
</span><a href="#local-6989586621679448322"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVarIdent -&gt; MetaVarIdent -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">MetaVarIdent
</span><a href="#local-6989586621679448327"><span class="hs-identifier hs-var">m'</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-comment">-- | Apply meta variable substitutions to a term.</span><span>
</span><span id="line-63"></span><span class="hs-comment">--</span><span>
</span><span id="line-64"></span><span class="hs-comment">-- &gt;&gt;&gt; applySubsts Foil.emptyScope [&quot;?m[x y] &#8614; Lam(z. App(z, App(x, y)))&quot;] &quot;Lam(x. ?m[App(x, ?m[x, x]), x])&quot;</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- Lam (x0 . Lam (x2 . App (x2, App (App (x0, Lam (x2 . App (x2, App (x0, x0)))), x0))))</span><span>
</span><span id="line-66"></span><span class="hs-comment">--</span><span>
</span><span id="line-67"></span><span class="hs-comment">-- &gt;&gt;&gt; applySubsts Foil.emptyScope [&quot;?m[x y] &#8614; App(y, x)&quot;] &quot;Lam(f. Lam(x. ?m[?m[x, f], f]))&quot;</span><span>
</span><span id="line-68"></span><span class="hs-comment">-- Lam (x0 . Lam (x1 . App (x0, App (x0, x1))))</span><span>
</span><span id="line-69"></span><span id="local-6989586621679448241"><span class="annot"><a href="Language.SOAS.Impl.html#applySubsts"><span class="hs-identifier hs-type">applySubsts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foil.Distinct</span></span><span> </span><span class="annot"><a href="#local-6989586621679448241"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foil.Scope</span></span><span> </span><span class="annot"><a href="#local-6989586621679448241"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.SOAS.Impl.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.SOAS.Impl.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679448241"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.SOAS.Impl.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679448241"><span class="hs-identifier hs-type">n</span></a></span></span><span>
</span><span id="line-70"></span><span id="applySubsts"><span class="annot"><span class="annottext">applySubsts :: forall (n :: S).
Distinct n =&gt;
Scope n -&gt; [Subst] -&gt; Term n -&gt; Term n
</span><a href="Language.SOAS.Impl.html#applySubsts"><span class="hs-identifier hs-var hs-var">applySubsts</span></a></span></span><span> </span><span id="local-6989586621679448333"><span class="annot"><span class="annottext">Scope n
</span><a href="#local-6989586621679448333"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span id="local-6989586621679448334"><span class="annot"><span class="annottext">[Subst]
</span><a href="#local-6989586621679448334"><span class="hs-identifier hs-var">substs</span></a></span></span><span> </span><span id="local-6989586621679448335"><span class="annot"><span class="annottext">Term n
</span><a href="#local-6989586621679448335"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Term n
</span><a href="#local-6989586621679448335"><span class="hs-identifier hs-var">term</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><a href="Language.SOAS.Impl.Generated.html#MetaVar"><span class="hs-identifier hs-type">MetaVar</span></a></span><span> </span><span id="local-6989586621679448337"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679448337"><span class="hs-identifier hs-var">_loc</span></a></span></span><span> </span><span id="local-6989586621679448338"><span class="annot"><span class="annottext">MetaVarIdent
</span><a href="#local-6989586621679448338"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679448339"><span class="annot"><span class="annottext">[Term n]
</span><a href="#local-6989586621679448339"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.SOAS.Impl.Generated.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="annot"><span class="annottext">BNFC'Position
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MetaVarIdent
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679448348"><span class="annot"><span class="annottext">Binders' BNFC'Position 'VoidS i
</span><a href="#local-6989586621679448348"><span class="hs-identifier hs-var">binders</span></a></span></span><span> </span><span id="local-6989586621679448349"><span class="annot"><span class="annottext">Term' BNFC'Position i
</span><a href="#local-6989586621679448349"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MetaVarIdent -&gt; [Subst] -&gt; Maybe Subst
</span><a href="Language.SOAS.Impl.html#lookupSubst"><span class="hs-identifier hs-var">lookupSubst</span></a></span><span> </span><span class="annot"><span class="annottext">MetaVarIdent
</span><a href="#local-6989586621679448338"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">[Subst]
</span><a href="#local-6989586621679448334"><span class="hs-identifier hs-var">substs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-73"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679448350"><span class="annot"><span class="annottext">args' :: [Term n]
</span><a href="#local-6989586621679448350"><span class="hs-identifier hs-var hs-var">args'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Term n -&gt; Term n) -&gt; [Term n] -&gt; [Term n]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope n -&gt; [Subst] -&gt; Term n -&gt; Term n
forall (n :: S).
Distinct n =&gt;
Scope n -&gt; [Subst] -&gt; Term n -&gt; Term n
</span><a href="Language.SOAS.Impl.html#applySubsts"><span class="hs-identifier hs-var">applySubsts</span></a></span><span> </span><span class="annot"><span class="annottext">Scope n
</span><a href="#local-6989586621679448333"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">[Subst]
</span><a href="#local-6989586621679448334"><span class="hs-identifier hs-var">substs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Term n]
</span><a href="#local-6989586621679448339"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-74"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Scope n
-&gt; Substitution
     (AST (Binders' BNFC'Position) (Term'Sig BNFC'Position)) 'VoidS n
-&gt; Binders' BNFC'Position 'VoidS i
-&gt; [Term n]
-&gt; Term' BNFC'Position i
-&gt; Term n
forall (sig :: * -&gt; * -&gt; *) (o :: S) (binder' :: S -&gt; S -&gt; *)
       (binder :: S -&gt; S -&gt; *) (n :: S) (i :: S).
(Bifunctor sig, Distinct o, CoSinkable binder', CoSinkable binder,
 SinkableK binder) =&gt;
Scope o
-&gt; Substitution (AST binder sig) n o
-&gt; binder' n i
-&gt; [AST binder sig o]
-&gt; AST binder sig i
-&gt; AST binder sig o
</span><span class="hs-identifier hs-var">substitutePattern</span></span><span> </span><span class="annot"><span class="annottext">Scope n
</span><a href="#local-6989586621679448333"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution
  (AST (Binders' BNFC'Position) (Term'Sig BNFC'Position)) 'VoidS n
forall (e :: S -&gt; *) (n :: S). Substitution e 'VoidS n
</span><span class="hs-identifier hs-var">Foil.voidSubst</span></span><span> </span><span class="annot"><span class="annottext">Binders' BNFC'Position 'VoidS i
</span><a href="#local-6989586621679448348"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="annot"><span class="annottext">[Term n]
</span><a href="#local-6989586621679448350"><span class="hs-identifier hs-var">args'</span></a></span><span> </span><span class="annot"><span class="annottext">Term' BNFC'Position i
</span><a href="#local-6989586621679448349"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term n
</span><a href="#local-6989586621679448335"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-comment">-- NOTE: generic recursive processing!</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Node</span></span><span> </span><span id="local-6989586621679448355"><span class="annot"><span class="annottext">Term'Sig
  BNFC'Position
  (ScopedAST (Binders' BNFC'Position) (Term'Sig BNFC'Position) n)
  (Term n)
</span><a href="#local-6989586621679448355"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term'Sig
  BNFC'Position
  (ScopedAST (Binders' BNFC'Position) (Term'Sig BNFC'Position) n)
  (Term n)
-&gt; Term n
forall (sig :: * -&gt; * -&gt; *) (binder :: S -&gt; S -&gt; *) (n :: S).
sig (ScopedAST binder sig n) (AST binder sig n) -&gt; AST binder sig n
</span><span class="hs-identifier hs-var">Node</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ScopedAST (Binders' BNFC'Position) (Term'Sig BNFC'Position) n
 -&gt; ScopedAST (Binders' BNFC'Position) (Term'Sig BNFC'Position) n)
-&gt; (Term n -&gt; Term n)
-&gt; Term'Sig
     BNFC'Position
     (ScopedAST (Binders' BNFC'Position) (Term'Sig BNFC'Position) n)
     (Term n)
-&gt; Term'Sig
     BNFC'Position
     (ScopedAST (Binders' BNFC'Position) (Term'Sig BNFC'Position) n)
     (Term n)
forall a b c d.
(a -&gt; b)
-&gt; (c -&gt; d)
-&gt; Term'Sig BNFC'Position a c
-&gt; Term'Sig BNFC'Position b d
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">ScopedAST (Binders' BNFC'Position) (Term'Sig BNFC'Position) n
-&gt; ScopedAST (Binders' BNFC'Position) (Term'Sig BNFC'Position) n
</span><a href="#local-6989586621679448357"><span class="hs-identifier hs-var">goScoped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope n -&gt; [Subst] -&gt; Term n -&gt; Term n
forall (n :: S).
Distinct n =&gt;
Scope n -&gt; [Subst] -&gt; Term n -&gt; Term n
</span><a href="Language.SOAS.Impl.html#applySubsts"><span class="hs-identifier hs-var">applySubsts</span></a></span><span> </span><span class="annot"><span class="annottext">Scope n
</span><a href="#local-6989586621679448333"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">[Subst]
</span><a href="#local-6989586621679448334"><span class="hs-identifier hs-var">substs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term'Sig
  BNFC'Position
  (ScopedAST (Binders' BNFC'Position) (Term'Sig BNFC'Position) n)
  (Term n)
</span><a href="#local-6989586621679448355"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-79"></span><span>    </span><span id="local-6989586621679448357"><span class="annot"><span class="annottext">goScoped :: ScopedAST (Binders' BNFC'Position) (Term'Sig BNFC'Position) n
-&gt; ScopedAST (Binders' BNFC'Position) (Term'Sig BNFC'Position) n
</span><a href="#local-6989586621679448357"><span class="hs-identifier hs-var hs-var">goScoped</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ScopedAST</span></span><span> </span><span id="local-6989586621679448361"><span class="annot"><span class="annottext">Binders' BNFC'Position n l
</span><a href="#local-6989586621679448361"><span class="hs-identifier hs-var">binders</span></a></span></span><span> </span><span id="local-6989586621679448362"><span class="annot"><span class="annottext">AST (Binders' BNFC'Position) (Term'Sig BNFC'Position) l
</span><a href="#local-6989586621679448362"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-80"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Binders' BNFC'Position n l -&gt; DistinctEvidence l
forall (n :: S) (pattern :: S -&gt; S -&gt; *) (l :: S).
(Distinct n, CoSinkable pattern) =&gt;
pattern n l -&gt; DistinctEvidence l
</span><span class="hs-identifier hs-var">Foil.assertDistinct</span></span><span> </span><span class="annot"><span class="annottext">Binders' BNFC'Position n l
</span><a href="#local-6989586621679448361"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-81"></span><span>        </span><span class="annot"><span class="annottext">DistinctEvidence l
</span><span class="hs-identifier hs-var">Foil.Distinct</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-82"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679448369"><span class="annot"><span class="annottext">scope' :: Scope l
</span><a href="#local-6989586621679448369"><span class="hs-identifier hs-var hs-var">scope'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Binders' BNFC'Position n l -&gt; Scope n -&gt; Scope l
forall (n :: S) (pattern :: S -&gt; S -&gt; *) (l :: S).
(Distinct n, CoSinkable pattern) =&gt;
pattern n l -&gt; Scope n -&gt; Scope l
</span><span class="hs-identifier hs-var">Foil.extendScopePattern</span></span><span> </span><span class="annot"><span class="annottext">Binders' BNFC'Position n l
</span><a href="#local-6989586621679448361"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="annot"><span class="annottext">Scope n
</span><a href="#local-6989586621679448333"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-83"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Binders' BNFC'Position n l
-&gt; AST (Binders' BNFC'Position) (Term'Sig BNFC'Position) l
-&gt; ScopedAST (Binders' BNFC'Position) (Term'Sig BNFC'Position) n
forall (binder :: S -&gt; S -&gt; *) (n :: S) (l :: S)
       (sig :: * -&gt; * -&gt; *).
binder n l -&gt; AST binder sig l -&gt; ScopedAST binder sig n
</span><span class="hs-identifier hs-var">ScopedAST</span></span><span> </span><span class="annot"><span class="annottext">Binders' BNFC'Position n l
</span><a href="#local-6989586621679448361"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope l
-&gt; [Subst]
-&gt; AST (Binders' BNFC'Position) (Term'Sig BNFC'Position) l
-&gt; AST (Binders' BNFC'Position) (Term'Sig BNFC'Position) l
forall (n :: S).
Distinct n =&gt;
Scope n -&gt; [Subst] -&gt; Term n -&gt; Term n
</span><a href="Language.SOAS.Impl.html#applySubsts"><span class="hs-identifier hs-var">applySubsts</span></a></span><span> </span><span class="annot"><span class="annottext">Scope l
</span><a href="#local-6989586621679448369"><span class="hs-identifier hs-var">scope'</span></a></span><span> </span><span class="annot"><span class="annottext">[Subst]
</span><a href="#local-6989586621679448334"><span class="hs-identifier hs-var">substs</span></a></span><span> </span><span class="annot"><span class="annottext">AST (Binders' BNFC'Position) (Term'Sig BNFC'Position) l
</span><a href="#local-6989586621679448362"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-comment">-- | Check if a (simultaneous) substitution is a solution to a set of constraints:</span><span>
</span><span id="line-86"></span><span class="hs-comment">--</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- &gt;&gt;&gt; isSolutionFor [&quot;?m[x y] &#8614; App(y, x)&quot;] [&quot;&#8704; f x. ?m[?m[x, f], f] = App(f, App(f, x))&quot;]</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- True</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- &gt;&gt;&gt; isSolutionFor [&quot;?m[x y] &#8614; App(y, x)&quot;] [&quot;&#8704; f x y. ?m[?m[x, f], f] = App(f, App(f, y))&quot;]</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- False</span><span>
</span><span id="line-91"></span><span class="hs-comment">--</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- &gt;&gt;&gt; isSolutionFor [&quot;?m[x] &#8614; Lam(f. App(f, x))&quot;] [&quot;&#8704; x. ?m[?m[x]] = Lam(f. App(f, Lam(f. App(f, x))))&quot;]</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- True</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- &gt;&gt;&gt; isSolutionFor [&quot;?m[x] &#8614; Lam(f. App(f, x))&quot;] [&quot;&#8704; y x. ?m[?m[x]] = Lam(f. App(f, Lam(f. App(f, y))))&quot;]</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- False</span><span>
</span><span id="line-96"></span><span class="annot"><a href="Language.SOAS.Impl.html#isSolutionFor"><span class="hs-identifier hs-type">isSolutionFor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.SOAS.Impl.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.SOAS.Impl.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-97"></span><span id="isSolutionFor"><span class="annot"><span class="annottext">isSolutionFor :: [Subst] -&gt; [Constraint] -&gt; Bool
</span><a href="Language.SOAS.Impl.html#isSolutionFor"><span class="hs-identifier hs-var hs-var">isSolutionFor</span></a></span></span><span> </span><span id="local-6989586621679448372"><span class="annot"><span class="annottext">[Subst]
</span><a href="#local-6989586621679448372"><span class="hs-identifier hs-var">substs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Constraint -&gt; Bool) -&gt; [Constraint] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Constraint -&gt; Bool
</span><a href="#local-6989586621679448374"><span class="hs-identifier hs-var">isSatisfied</span></a></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-99"></span><span>    </span><span id="local-6989586621679448374"><span class="annot"><span class="annottext">isSatisfied :: Constraint -&gt; Bool
</span><a href="#local-6989586621679448374"><span class="hs-identifier hs-var hs-var">isSatisfied</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.SOAS.Impl.Generated.html#ConstraintEq"><span class="hs-identifier hs-type">ConstraintEq</span></a></span><span> </span><span id="local-6989586621679448379"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679448379"><span class="hs-identifier hs-var">_loc</span></a></span></span><span> </span><span id="local-6989586621679448380"><span class="annot"><span class="annottext">Binders' BNFC'Position 'VoidS i
</span><a href="#local-6989586621679448380"><span class="hs-identifier hs-var">binders</span></a></span></span><span> </span><span id="local-6989586621679448381"><span class="annot"><span class="annottext">Term' BNFC'Position i
</span><a href="#local-6989586621679448381"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679448382"><span class="annot"><span class="annottext">Term' BNFC'Position i
</span><a href="#local-6989586621679448382"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-100"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Binders' BNFC'Position 'VoidS i -&gt; DistinctEvidence i
forall (n :: S) (pattern :: S -&gt; S -&gt; *) (l :: S).
(Distinct n, CoSinkable pattern) =&gt;
pattern n l -&gt; DistinctEvidence l
</span><span class="hs-identifier hs-var">Foil.assertDistinct</span></span><span> </span><span class="annot"><span class="annottext">Binders' BNFC'Position 'VoidS i
</span><a href="#local-6989586621679448380"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-101"></span><span>        </span><span class="annot"><span class="annottext">DistinctEvidence i
</span><span class="hs-identifier hs-var">Foil.Distinct</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-102"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679448398"><span class="annot"><span class="annottext">scope :: Scope i
</span><a href="#local-6989586621679448398"><span class="hs-identifier hs-var hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Binders' BNFC'Position 'VoidS i -&gt; Scope 'VoidS -&gt; Scope i
forall (n :: S) (pattern :: S -&gt; S -&gt; *) (l :: S).
(Distinct n, CoSinkable pattern) =&gt;
pattern n l -&gt; Scope n -&gt; Scope l
</span><span class="hs-identifier hs-var">Foil.extendScopePattern</span></span><span> </span><span class="annot"><span class="annottext">Binders' BNFC'Position 'VoidS i
</span><a href="#local-6989586621679448380"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="annot"><span class="annottext">Scope 'VoidS
</span><span class="hs-identifier hs-var">Foil.emptyScope</span></span><span>
</span><span id="line-103"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Scope i -&gt; Term' BNFC'Position i -&gt; Term' BNFC'Position i -&gt; Bool
forall (sig :: * -&gt; * -&gt; *) (n :: S) (binder :: S -&gt; S -&gt; *).
(Bitraversable sig, ZipMatchK sig, Distinct n,
 UnifiablePattern binder, SinkableK binder) =&gt;
Scope n -&gt; AST binder sig n -&gt; AST binder sig n -&gt; Bool
</span><span class="hs-identifier hs-var">alphaEquiv</span></span><span> </span><span class="annot"><span class="annottext">Scope i
</span><a href="#local-6989586621679448398"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope i
-&gt; [Subst] -&gt; Term' BNFC'Position i -&gt; Term' BNFC'Position i
forall (n :: S).
Distinct n =&gt;
Scope n -&gt; [Subst] -&gt; Term n -&gt; Term n
</span><a href="Language.SOAS.Impl.html#applySubsts"><span class="hs-identifier hs-var">applySubsts</span></a></span><span> </span><span class="annot"><span class="annottext">Scope i
</span><a href="#local-6989586621679448398"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">[Subst]
</span><a href="#local-6989586621679448372"><span class="hs-identifier hs-var">substs</span></a></span><span> </span><span class="annot"><span class="annottext">Term' BNFC'Position i
</span><a href="#local-6989586621679448381"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope i
-&gt; [Subst] -&gt; Term' BNFC'Position i -&gt; Term' BNFC'Position i
forall (n :: S).
Distinct n =&gt;
Scope n -&gt; [Subst] -&gt; Term n -&gt; Term n
</span><a href="Language.SOAS.Impl.html#applySubsts"><span class="hs-identifier hs-var">applySubsts</span></a></span><span> </span><span class="annot"><span class="annottext">Scope i
</span><a href="#local-6989586621679448398"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">[Subst]
</span><a href="#local-6989586621679448372"><span class="hs-identifier hs-var">substs</span></a></span><span> </span><span class="annot"><span class="annottext">Term' BNFC'Position i
</span><a href="#local-6989586621679448382"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="annot"><span class="hs-comment">-- * Entrypoint</span></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="annot"><span class="hs-comment">-- | A SOAS interpreter implemented via the free foil.</span></span><span>
</span><span id="line-108"></span><span class="annot"><a href="Language.SOAS.Impl.html#defaultMain"><span class="hs-identifier hs-type">defaultMain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span id="defaultMain"><span class="annot"><span class="annottext">defaultMain :: IO ()
</span><a href="Language.SOAS.Impl.html#defaultMain"><span class="hs-identifier hs-var hs-var">defaultMain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-110"></span><span>  </span><span id="local-6989586621679448402"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679448402"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String
</span><span class="hs-identifier hs-var">getContents</span></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Token] -&gt; Err TermTyping
</span><a href="Language.SOAS.Syntax.Par.html#pTermTyping"><span class="hs-identifier hs-var">Raw.pTermTyping</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [Token]
</span><a href="Language.SOAS.Syntax.Lex.html#tokens"><span class="hs-identifier hs-var">Raw.tokens</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679448402"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679448406"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679448406"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679448406"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-114"></span><span>      </span><span class="annot"><span class="annottext">IO ()
forall a. IO a
</span><span class="hs-identifier hs-var">exitFailure</span></span><span>
</span><span id="line-115"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679448408"><span class="annot"><span class="annottext">TermTyping
</span><a href="#local-6989586621679448408"><span class="hs-identifier hs-var">typing</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermTyping -&gt; String
forall a. Print a =&gt; a -&gt; String
</span><a href="Language.SOAS.Syntax.Print.html#printTree"><span class="hs-identifier hs-var">Raw.printTree</span></a></span><span> </span><span class="annot"><span class="annottext">TermTyping
</span><a href="#local-6989586621679448408"><span class="hs-identifier hs-var">typing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span></pre></body></html>