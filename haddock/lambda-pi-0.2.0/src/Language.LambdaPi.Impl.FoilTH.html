<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds                  #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies               #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies         #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE GADTs                      #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE InstanceSigs               #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE KindSignatures             #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase                 #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE LiberalTypeSynonyms        #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings          #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes                 #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables        #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving         #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell            #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications           #-}</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- | Foil implementation of the \(\lambda\Pi\)-calculus (with pairs)</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- using Template Haskell and &quot;Generics.Kind&quot; to reduce boilerplate.</span><span>
</span><span id="line-18"></span><span class="hs-comment">--</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- Template Haskell helpers __generate__ the following:</span><span>
</span><span id="line-20"></span><span class="hs-comment">--</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- 1. Scope-safe AST, generated from a raw definition. See 'FoilTerm', 'FoilScopedTerm', and 'FoilPattern'.</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- 2. Conversion between scope-safe and raw term representation (the latter is generated via BNFC), see 'toFoilTerm'' and 'fromFoilTerm''.</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- 3. Helper functions for patterns. See 'extendScopeFoilPattern'' and 'withRefreshedFoilPattern''.</span><span>
</span><span id="line-24"></span><span class="hs-comment">--</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- The following is provided via kind-polymophic generics (see &quot;Generics.Kind&quot;):</span><span>
</span><span id="line-26"></span><span class="hs-comment">--</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- 1. 'Sinkable' instance for 'FoilTerm''.</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- 2. 'CoSinkable' instance for 'FoilPattern'', giving access to 'extendScopePattern' and 'withRefreshedPattern' (among other utilities).</span><span>
</span><span id="line-29"></span><span class="hs-comment">--</span><span>
</span><span id="line-30"></span><span class="hs-comment">-- The following is implemented __manually__ in this module:</span><span>
</span><span id="line-31"></span><span class="hs-comment">--</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- 1. Correct capture-avoiding substitution (see 'substitute').</span><span>
</span><span id="line-33"></span><span class="hs-comment">-- 2. Computation of weak head normal form (WHNF), see 'whnf'.</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- 3. Entry point, gluing everything together. See 'defaultMain'.</span><span>
</span><span id="line-35"></span><span class="hs-comment">--</span><span>
</span><span id="line-36"></span><span class="hs-comment">-- The following is __not implemented__:</span><span>
</span><span id="line-37"></span><span class="hs-comment">--</span><span>
</span><span id="line-38"></span><span class="hs-comment">-- 1. \(\alpha\)-equivalence checks and \(\alpha\)-normalization helpers.</span><span>
</span><span id="line-39"></span><span class="hs-comment">--</span><span>
</span><span id="line-40"></span><span class="hs-comment">-- This implementation supports (nested) patterns for pairs.</span><span>
</span><span id="line-41"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.LambdaPi.Impl.FoilTH</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Foil</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Foil.TH</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span>                        </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Language.LambdaPi.Syntax.Abs.html"><span class="hs-identifier">Language.LambdaPi.Syntax.Abs</span></a></span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Raw</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Language.LambdaPi.Syntax.Layout.html"><span class="hs-identifier">Language.LambdaPi.Syntax.Layout</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Raw</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Language.LambdaPi.Syntax.Lex.html"><span class="hs-identifier">Language.LambdaPi.Syntax.Lex</span></a></span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Raw</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Language.LambdaPi.Syntax.Par.html"><span class="hs-identifier">Language.LambdaPi.Syntax.Par</span></a></span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Raw</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Language.LambdaPi.Syntax.Print.html"><span class="hs-identifier">Language.LambdaPi.Syntax.Print</span></a></span><span>  </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Raw</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Generics.Kind.TH</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.Exit</span></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">exitFailure</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="annot"><span class="hs-comment">-- * Generated code</span></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="annot"><span class="hs-comment">-- ** Scope-safe AST</span></span><span>
</span><span id="line-58"></span><span id="FoilTerm%27"><span id="local-6989586621679263916"><span id="local-6989586621679263917"><span id="FoilPattern%27"><span id="FoilScopedTerm%27"><span id="local-6989586621679263977"><span id="local-6989586621679263990"><span id="local-6989586621679263991"><span id="local-6989586621679263992"><span id="local-6989586621679264012"><span id="local-6989586621679264013"><span id="local-6989586621679264368"><span id="local-6989586621679264369"><span id="FoilPatternWildcard"><span id="FoilPatternVar"><span id="FoilPatternPair"><span id="FoilAScopedTerm"><span id="FoilVar"><span id="FoilPi"><span id="FoilLam"><span id="FoilApp"><span id="FoilProduct"><span id="FoilPair"><span id="FoilFirst"><span id="FoilSecond"><span id="FoilUniverse"><span class="hs-identifier">mkFoilData</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Raw.Term'</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Raw.VarIdent</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Raw.ScopedTerm'</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Raw.Pattern'</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-59"></span><span class="hs-comment">-- mkInstancesFoil ''Raw.Term' ''Raw.VarIdent ''Raw.ScopedTerm' ''Raw.Pattern'</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span id="RepK"><span id="local-6989586621679263916"><span id="local-6989586621679263917"><span id="local-6989586621679264384"><span id="local-6989586621679264386"><span id="local-6989586621679264388"><span id="local-6989586621679264390"><span id="local-6989586621679264392"><span id="local-6989586621679264394"><span class="hs-identifier">deriveGenericK</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">FoilTerm'</span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-62"></span><span id="RepK"><span id="local-6989586621679263917"><span id="local-6989586621679263977"><span id="local-6989586621679264552"><span id="local-6989586621679264554"><span id="local-6989586621679264556"><span id="local-6989586621679264558"><span id="local-6989586621679264560"><span id="local-6989586621679264562"><span class="hs-identifier">deriveGenericK</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">FoilScopedTerm'</span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-63"></span><span id="RepK"><span id="local-6989586621679263990"><span id="local-6989586621679263991"><span id="local-6989586621679263992"><span id="local-6989586621679264585"><span id="local-6989586621679264587"><span id="local-6989586621679264589"><span id="local-6989586621679264591"><span id="local-6989586621679264593"><span id="local-6989586621679264595"><span id="local-6989586621679264597"><span id="local-6989586621679264599"><span class="hs-identifier">deriveGenericK</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">FoilPattern'</span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679264061"><span id="local-6989586621679264689"><span class="annot"><span class="hs-identifier hs-type">SinkableK</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilTerm%27"><span class="hs-identifier hs-type">FoilTerm'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264061"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-65"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679264060"><span id="local-6989586621679264758"><span class="annot"><span class="hs-identifier hs-type">SinkableK</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilScopedTerm%27"><span class="hs-identifier hs-type">FoilScopedTerm'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264060"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679264059"><span id="local-6989586621679264772"><span class="annot"><span class="hs-identifier hs-type">SinkableK</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilPattern%27"><span class="hs-identifier hs-type">FoilPattern'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264059"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679264113"><span id="local-6989586621679264807"><span id="local-6989586621679264811"><span id="local-6989586621679264814"><span id="local-6989586621679264820"><span class="annot"><span class="hs-identifier hs-type">HasNameBinders</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilPattern%27"><span class="hs-identifier hs-type">FoilPattern'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264113"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679264119"><span id="local-6989586621679264879"><span class="annot"><span class="hs-identifier hs-type">Sinkable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilTerm%27"><span class="hs-identifier hs-type">FoilTerm'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264119"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679264149"><span id="local-6989586621679264937"><span id="local-6989586621679264944"><span class="annot"><span class="hs-identifier hs-type">CoSinkable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilPattern%27"><span class="hs-identifier hs-type">FoilPattern'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264149"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="annot"><span class="hs-comment">-- ** Conversion from raw to scope-safe AST</span></span><span>
</span><span id="line-73"></span><span id="local-6989586621679263916"><span id="local-6989586621679263977"><span id="local-6989586621679263990"><span id="local-6989586621679264150"><span id="local-6989586621679264151"><span id="local-6989586621679264152"><span id="local-6989586621679264153"><span id="local-6989586621679264155"><span id="local-6989586621679264156"><span id="local-6989586621679264157"><span id="local-6989586621679264159"><span id="local-6989586621679264160"><span id="local-6989586621679264165"><span id="local-6989586621679264166"><span id="toFoilTerm%27"><span id="extendScopeFoilPattern%27"><span id="withRefreshedFoilPattern%27"><span id="toFoilPattern%27"><span id="toFoilScopedTerm%27"><span class="hs-identifier">mkToFoil</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Raw.Term'</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Raw.VarIdent</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Raw.ScopedTerm'</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Raw.Pattern'</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="annot"><span class="hs-comment">-- ** Conversion from scope-safe to raw AST</span></span><span>
</span><span id="line-76"></span><span id="local-6989586621679263916"><span id="local-6989586621679263977"><span id="local-6989586621679263990"><span id="local-6989586621679264234"><span id="local-6989586621679264236"><span id="local-6989586621679264237"><span id="fromFoilTerm%27"><span id="fromFoilPattern%27"><span id="fromFoilScopedTerm%27"><span class="hs-identifier">mkFromFoil</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Raw.Term'</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Raw.VarIdent</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Raw.ScopedTerm'</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Raw.Pattern'</span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">type</span><span> </span><span id="FoilTerm"><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilTerm"><span class="hs-identifier hs-var">FoilTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilTerm%27"><span class="hs-identifier hs-type">FoilTerm'</span></a></span><span> </span><span class="annot"><a href="Language.LambdaPi.Syntax.Abs.html#BNFC%27Position"><span class="hs-identifier hs-type">Raw.BNFC'Position</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">type</span><span> </span><span id="FoilPattern"><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilPattern"><span class="hs-identifier hs-var">FoilPattern</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilPattern%27"><span class="hs-identifier hs-type">FoilPattern'</span></a></span><span> </span><span class="annot"><a href="Language.LambdaPi.Syntax.Abs.html#BNFC%27Position"><span class="hs-identifier hs-type">Raw.BNFC'Position</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="annot"><span class="hs-comment">-- | Convert a /closed/ scope-safe term into a raw term.</span></span><span>
</span><span id="line-82"></span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#fromFoilTermClosed"><span class="hs-identifier hs-type">fromFoilTermClosed</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.LambdaPi.Syntax.Abs.html#VarIdent"><span class="hs-identifier hs-type">Raw.VarIdent</span></a></span><span class="hs-special">]</span><span>   </span><span class="annot"><span class="hs-comment">-- ^ A stream of fresh variable identifiers.</span></span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilTerm"><span class="hs-identifier hs-type">FoilTerm</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VoidS</span></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ A scope safe term in scope @n@.</span></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LambdaPi.Syntax.Abs.html#Term"><span class="hs-identifier hs-type">Raw.Term</span></a></span><span>
</span><span id="line-86"></span><span id="fromFoilTermClosed"><span class="annot"><span class="annottext">fromFoilTermClosed :: [VarIdent] -&gt; FoilTerm 'VoidS -&gt; Term
</span><a href="Language.LambdaPi.Impl.FoilTH.html#fromFoilTermClosed"><span class="hs-identifier hs-var hs-var">fromFoilTermClosed</span></a></span></span><span> </span><span id="local-6989586621679265320"><span class="annot"><span class="annottext">[VarIdent]
</span><a href="#local-6989586621679265320"><span class="hs-identifier hs-var">freshVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VarIdent] -&gt; NameMap 'VoidS VarIdent -&gt; FoilTerm 'VoidS -&gt; Term
forall (n :: S) a.
[VarIdent] -&gt; NameMap n VarIdent -&gt; FoilTerm' a n -&gt; Term' a
</span><a href="Language.LambdaPi.Impl.FoilTH.html#fromFoilTerm%27"><span class="hs-identifier hs-var">fromFoilTerm'</span></a></span><span> </span><span class="annot"><span class="annottext">[VarIdent]
</span><a href="#local-6989586621679265320"><span class="hs-identifier hs-var">freshVars</span></a></span><span> </span><span class="annot"><span class="annottext">NameMap 'VoidS VarIdent
forall a. NameMap 'VoidS a
</span><span class="hs-identifier hs-var">emptyNameMap</span></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679264259"><span class="annot"><span class="hs-identifier hs-type">InjectName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilTerm%27"><span class="hs-identifier hs-type">FoilTerm'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264259"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-89"></span><span>  </span><span id="local-6989586621679265327"><span class="annot"><span class="annottext">injectName :: forall (n :: S). Name n -&gt; FoilTerm' a n
</span><a href="#local-6989586621679265327"><span class="hs-identifier hs-var hs-var hs-var hs-var">injectName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Name n -&gt; FoilTerm' a n
forall a (n :: S). a -&gt; Name n -&gt; FoilTerm' a n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#FoilVar"><span class="hs-identifier hs-var">FoilVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;undefined location&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="annot"><span class="hs-comment">-- * User-defined</span></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="annot"><span class="hs-comment">-- ** Substitution</span></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="annot"><span class="hs-comment">-- | Perform substitution in a \(\lambda\Pi\)-term.</span></span><span>
</span><span id="line-96"></span><span id="local-6989586621679264261"><span id="local-6989586621679264262"><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#substitute"><span class="hs-identifier hs-type">substitute</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Distinct</span></span><span> </span><span class="annot"><a href="#local-6989586621679264261"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Scope</span></span><span> </span><span class="annot"><a href="#local-6989586621679264261"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Substitution</span></span><span> </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilTerm"><span class="hs-identifier hs-type">FoilTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264262"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264261"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilTerm"><span class="hs-identifier hs-type">FoilTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264262"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilTerm"><span class="hs-identifier hs-type">FoilTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264261"><span class="hs-identifier hs-type">o</span></a></span></span></span><span>
</span><span id="line-97"></span><span id="substitute"><span class="annot"><span class="annottext">substitute :: forall (o :: S) (i :: S).
Distinct o =&gt;
Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
</span><a href="Language.LambdaPi.Impl.FoilTH.html#substitute"><span class="hs-identifier hs-var hs-var">substitute</span></a></span></span><span> </span><span id="local-6989586621679265339"><span class="annot"><span class="annottext">Scope o
</span><a href="#local-6989586621679265339"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span id="local-6989586621679265340"><span class="annot"><span class="annottext">Substitution FoilTerm i o
</span><a href="#local-6989586621679265340"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilVar"><span class="hs-identifier hs-type">FoilVar</span></a></span><span> </span><span id="local-6989586621679265341"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265341"><span class="hs-identifier hs-var">_loc</span></a></span></span><span> </span><span id="local-6989586621679265342"><span class="annot"><span class="annottext">Name i
</span><a href="#local-6989586621679265342"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm i o -&gt; Name i -&gt; FoilTerm o
forall (e :: S -&gt; *) (i :: S) (o :: S).
InjectName e =&gt;
Substitution e i o -&gt; Name i -&gt; e o
</span><span class="hs-identifier hs-var">lookupSubst</span></span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm i o
</span><a href="#local-6989586621679265340"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Name i
</span><a href="#local-6989586621679265342"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilApp"><span class="hs-identifier hs-type">FoilApp</span></a></span><span> </span><span id="local-6989586621679265344"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265344"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621679265345"><span class="annot"><span class="annottext">FoilTerm i
</span><a href="#local-6989586621679265345"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679265346"><span class="annot"><span class="annottext">FoilTerm i
</span><a href="#local-6989586621679265346"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BNFC'Position -&gt; FoilTerm o -&gt; FoilTerm o -&gt; FoilTerm o
forall a (n :: S).
a -&gt; FoilTerm' a n -&gt; FoilTerm' a n -&gt; FoilTerm' a n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#FoilApp"><span class="hs-identifier hs-var">FoilApp</span></a></span><span> </span><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265344"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
forall (o :: S) (i :: S).
Distinct o =&gt;
Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
</span><a href="Language.LambdaPi.Impl.FoilTH.html#substitute"><span class="hs-identifier hs-var">substitute</span></a></span><span> </span><span class="annot"><span class="annottext">Scope o
</span><a href="#local-6989586621679265339"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm i o
</span><a href="#local-6989586621679265340"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm i
</span><a href="#local-6989586621679265345"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
forall (o :: S) (i :: S).
Distinct o =&gt;
Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
</span><a href="Language.LambdaPi.Impl.FoilTH.html#substitute"><span class="hs-identifier hs-var">substitute</span></a></span><span> </span><span class="annot"><span class="annottext">Scope o
</span><a href="#local-6989586621679265339"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm i o
</span><a href="#local-6989586621679265340"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm i
</span><a href="#local-6989586621679265346"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilLam"><span class="hs-identifier hs-type">FoilLam</span></a></span><span> </span><span id="local-6989586621679265351"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265351"><span class="hs-identifier hs-var">loc1</span></a></span></span><span> </span><span id="local-6989586621679265352"><span class="annot"><span class="annottext">FoilPattern' BNFC'Position i l
</span><a href="#local-6989586621679265352"><span class="hs-identifier hs-var">pattern</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilAScopedTerm"><span class="hs-identifier hs-type">FoilAScopedTerm</span></a></span><span> </span><span id="local-6989586621679265353"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265353"><span class="hs-identifier hs-var">loc2</span></a></span></span><span> </span><span id="local-6989586621679265354"><span class="annot"><span class="annottext">FoilTerm' BNFC'Position l
</span><a href="#local-6989586621679265354"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Scope o
-&gt; FoilPattern' BNFC'Position i l
-&gt; (forall {o' :: S}.
    DExt o o' =&gt;
    (Substitution FoilTerm i o -&gt; Substitution FoilTerm l o')
    -&gt; FoilPattern' BNFC'Position o o' -&gt; FoilTerm o)
-&gt; FoilTerm o
forall (o :: S) (pattern :: S -&gt; S -&gt; *) (e :: S -&gt; *) (n :: S)
       (l :: S) r.
(Distinct o, CoSinkable pattern, Sinkable e, InjectName e) =&gt;
Scope o
-&gt; pattern n l
-&gt; (forall (o' :: S).
    DExt o o' =&gt;
    (Substitution e n o -&gt; Substitution e l o') -&gt; pattern o o' -&gt; r)
-&gt; r
</span><span class="hs-identifier hs-var">withRefreshedPattern</span></span><span> </span><span class="annot"><span class="annottext">Scope o
</span><a href="#local-6989586621679265339"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">FoilPattern' BNFC'Position i l
</span><a href="#local-6989586621679265352"><span class="hs-identifier hs-var">pattern</span></a></span><span> </span><span class="annot"><span class="annottext">((forall {o' :: S}.
  DExt o o' =&gt;
  (Substitution FoilTerm i o -&gt; Substitution FoilTerm l o')
  -&gt; FoilPattern' BNFC'Position o o' -&gt; FoilTerm o)
 -&gt; FoilTerm o)
-&gt; (forall {o' :: S}.
    DExt o o' =&gt;
    (Substitution FoilTerm i o -&gt; Substitution FoilTerm l o')
    -&gt; FoilPattern' BNFC'Position o o' -&gt; FoilTerm o)
-&gt; FoilTerm o
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679265360"><span class="annot"><span class="annottext">Substitution FoilTerm i o -&gt; Substitution FoilTerm l o'
</span><a href="#local-6989586621679265360"><span class="hs-identifier hs-var">extendSubst</span></a></span></span><span> </span><span id="local-6989586621679265361"><span class="annot"><span class="annottext">FoilPattern' BNFC'Position o o'
</span><a href="#local-6989586621679265361"><span class="hs-identifier hs-var">pattern'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-101"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679265362"><span class="annot"><span class="annottext">subst' :: Substitution FoilTerm l o'
</span><a href="#local-6989586621679265362"><span class="hs-identifier hs-var hs-var">subst'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm i o -&gt; Substitution FoilTerm l o'
</span><a href="#local-6989586621679265360"><span class="hs-identifier hs-var">extendSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm i o
</span><a href="#local-6989586621679265340"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-102"></span><span>          </span><span id="local-6989586621679265363"><span class="annot"><span class="annottext">scope' :: Scope o'
</span><a href="#local-6989586621679265363"><span class="hs-identifier hs-var hs-var">scope'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FoilPattern' BNFC'Position o o' -&gt; Scope o -&gt; Scope o'
forall (n :: S) (pattern :: S -&gt; S -&gt; *) (l :: S).
(Distinct n, CoSinkable pattern) =&gt;
pattern n l -&gt; Scope n -&gt; Scope l
</span><span class="hs-identifier hs-var">extendScopePattern</span></span><span> </span><span class="annot"><span class="annottext">FoilPattern' BNFC'Position o o'
</span><a href="#local-6989586621679265361"><span class="hs-identifier hs-var">pattern'</span></a></span><span> </span><span class="annot"><span class="annottext">Scope o
</span><a href="#local-6989586621679265339"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-103"></span><span>          </span><span id="local-6989586621679265364"><span class="annot"><span class="annottext">body' :: FoilTerm o'
</span><a href="#local-6989586621679265364"><span class="hs-identifier hs-var hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scope o'
-&gt; Substitution FoilTerm l o'
-&gt; FoilTerm' BNFC'Position l
-&gt; FoilTerm o'
forall (o :: S) (i :: S).
Distinct o =&gt;
Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
</span><a href="Language.LambdaPi.Impl.FoilTH.html#substitute"><span class="hs-identifier hs-var">substitute</span></a></span><span> </span><span class="annot"><span class="annottext">Scope o'
</span><a href="#local-6989586621679265363"><span class="hs-identifier hs-var">scope'</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm l o'
</span><a href="#local-6989586621679265362"><span class="hs-identifier hs-var">subst'</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm' BNFC'Position l
</span><a href="#local-6989586621679265354"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-104"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">BNFC'Position
-&gt; FoilPattern' BNFC'Position o o'
-&gt; FoilScopedTerm' BNFC'Position o'
-&gt; FoilTerm o
forall a (n :: S) (n2 :: S).
a -&gt; FoilPattern' a n n2 -&gt; FoilScopedTerm' a n2 -&gt; FoilTerm' a n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#FoilLam"><span class="hs-identifier hs-var">FoilLam</span></a></span><span> </span><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265351"><span class="hs-identifier hs-var">loc1</span></a></span><span> </span><span class="annot"><span class="annottext">FoilPattern' BNFC'Position o o'
</span><a href="#local-6989586621679265361"><span class="hs-identifier hs-var">pattern'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BNFC'Position -&gt; FoilTerm o' -&gt; FoilScopedTerm' BNFC'Position o'
forall a (n :: S). a -&gt; FoilTerm' a n -&gt; FoilScopedTerm' a n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#FoilAScopedTerm"><span class="hs-identifier hs-var">FoilAScopedTerm</span></a></span><span> </span><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265353"><span class="hs-identifier hs-var">loc2</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm o'
</span><a href="#local-6989586621679265364"><span class="hs-identifier hs-var">body'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilPi"><span class="hs-identifier hs-type">FoilPi</span></a></span><span> </span><span id="local-6989586621679265369"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265369"><span class="hs-identifier hs-var">loc1</span></a></span></span><span> </span><span id="local-6989586621679265370"><span class="annot"><span class="annottext">FoilPattern' BNFC'Position i l
</span><a href="#local-6989586621679265370"><span class="hs-identifier hs-var">pattern</span></a></span></span><span> </span><span id="local-6989586621679265371"><span class="annot"><span class="annottext">FoilTerm i
</span><a href="#local-6989586621679265371"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilAScopedTerm"><span class="hs-identifier hs-type">FoilAScopedTerm</span></a></span><span> </span><span id="local-6989586621679265372"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265372"><span class="hs-identifier hs-var">loc2</span></a></span></span><span> </span><span id="local-6989586621679265373"><span class="annot"><span class="annottext">FoilTerm' BNFC'Position l
</span><a href="#local-6989586621679265373"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Scope o
-&gt; FoilPattern' BNFC'Position i l
-&gt; (forall {o' :: S}.
    DExt o o' =&gt;
    (Substitution FoilTerm i o -&gt; Substitution FoilTerm l o')
    -&gt; FoilPattern' BNFC'Position o o' -&gt; FoilTerm o)
-&gt; FoilTerm o
forall (o :: S) (pattern :: S -&gt; S -&gt; *) (e :: S -&gt; *) (n :: S)
       (l :: S) r.
(Distinct o, CoSinkable pattern, Sinkable e, InjectName e) =&gt;
Scope o
-&gt; pattern n l
-&gt; (forall (o' :: S).
    DExt o o' =&gt;
    (Substitution e n o -&gt; Substitution e l o') -&gt; pattern o o' -&gt; r)
-&gt; r
</span><span class="hs-identifier hs-var">withRefreshedPattern</span></span><span> </span><span class="annot"><span class="annottext">Scope o
</span><a href="#local-6989586621679265339"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">FoilPattern' BNFC'Position i l
</span><a href="#local-6989586621679265370"><span class="hs-identifier hs-var">pattern</span></a></span><span> </span><span class="annot"><span class="annottext">((forall {o' :: S}.
  DExt o o' =&gt;
  (Substitution FoilTerm i o -&gt; Substitution FoilTerm l o')
  -&gt; FoilPattern' BNFC'Position o o' -&gt; FoilTerm o)
 -&gt; FoilTerm o)
-&gt; (forall {o' :: S}.
    DExt o o' =&gt;
    (Substitution FoilTerm i o -&gt; Substitution FoilTerm l o')
    -&gt; FoilPattern' BNFC'Position o o' -&gt; FoilTerm o)
-&gt; FoilTerm o
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679265380"><span class="annot"><span class="annottext">Substitution FoilTerm i o -&gt; Substitution FoilTerm l o'
</span><a href="#local-6989586621679265380"><span class="hs-identifier hs-var">extendSubst</span></a></span></span><span> </span><span id="local-6989586621679265381"><span class="annot"><span class="annottext">FoilPattern' BNFC'Position o o'
</span><a href="#local-6989586621679265381"><span class="hs-identifier hs-var">pattern'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-106"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679265382"><span class="annot"><span class="annottext">subst' :: Substitution FoilTerm l o'
</span><a href="#local-6989586621679265382"><span class="hs-identifier hs-var hs-var">subst'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm i o -&gt; Substitution FoilTerm l o'
</span><a href="#local-6989586621679265380"><span class="hs-identifier hs-var">extendSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm i o
</span><a href="#local-6989586621679265340"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-107"></span><span>          </span><span id="local-6989586621679265383"><span class="annot"><span class="annottext">scope' :: Scope o'
</span><a href="#local-6989586621679265383"><span class="hs-identifier hs-var hs-var">scope'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FoilPattern' BNFC'Position o o' -&gt; Scope o -&gt; Scope o'
forall (n :: S) (pattern :: S -&gt; S -&gt; *) (l :: S).
(Distinct n, CoSinkable pattern) =&gt;
pattern n l -&gt; Scope n -&gt; Scope l
</span><span class="hs-identifier hs-var">extendScopePattern</span></span><span> </span><span class="annot"><span class="annottext">FoilPattern' BNFC'Position o o'
</span><a href="#local-6989586621679265381"><span class="hs-identifier hs-var">pattern'</span></a></span><span> </span><span class="annot"><span class="annottext">Scope o
</span><a href="#local-6989586621679265339"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-108"></span><span>          </span><span id="local-6989586621679265384"><span class="annot"><span class="annottext">a' :: FoilTerm o
</span><a href="#local-6989586621679265384"><span class="hs-identifier hs-var hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
forall (o :: S) (i :: S).
Distinct o =&gt;
Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
</span><a href="Language.LambdaPi.Impl.FoilTH.html#substitute"><span class="hs-identifier hs-var">substitute</span></a></span><span> </span><span class="annot"><span class="annottext">Scope o
</span><a href="#local-6989586621679265339"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm i o
</span><a href="#local-6989586621679265340"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm i
</span><a href="#local-6989586621679265371"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-109"></span><span>          </span><span id="local-6989586621679265385"><span class="annot"><span class="annottext">b' :: FoilTerm o'
</span><a href="#local-6989586621679265385"><span class="hs-identifier hs-var hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scope o'
-&gt; Substitution FoilTerm l o'
-&gt; FoilTerm' BNFC'Position l
-&gt; FoilTerm o'
forall (o :: S) (i :: S).
Distinct o =&gt;
Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
</span><a href="Language.LambdaPi.Impl.FoilTH.html#substitute"><span class="hs-identifier hs-var">substitute</span></a></span><span> </span><span class="annot"><span class="annottext">Scope o'
</span><a href="#local-6989586621679265383"><span class="hs-identifier hs-var">scope'</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm l o'
</span><a href="#local-6989586621679265382"><span class="hs-identifier hs-var">subst'</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm' BNFC'Position l
</span><a href="#local-6989586621679265373"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-110"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">BNFC'Position
-&gt; FoilPattern' BNFC'Position o o'
-&gt; FoilTerm o
-&gt; FoilScopedTerm' BNFC'Position o'
-&gt; FoilTerm o
forall a (n :: S) (n2 :: S).
a
-&gt; FoilPattern' a n n2
-&gt; FoilTerm' a n
-&gt; FoilScopedTerm' a n2
-&gt; FoilTerm' a n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#FoilPi"><span class="hs-identifier hs-var">FoilPi</span></a></span><span> </span><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265369"><span class="hs-identifier hs-var">loc1</span></a></span><span> </span><span class="annot"><span class="annottext">FoilPattern' BNFC'Position o o'
</span><a href="#local-6989586621679265381"><span class="hs-identifier hs-var">pattern'</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm o
</span><a href="#local-6989586621679265384"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BNFC'Position -&gt; FoilTerm o' -&gt; FoilScopedTerm' BNFC'Position o'
forall a (n :: S). a -&gt; FoilTerm' a n -&gt; FoilScopedTerm' a n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#FoilAScopedTerm"><span class="hs-identifier hs-var">FoilAScopedTerm</span></a></span><span> </span><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265372"><span class="hs-identifier hs-var">loc2</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm o'
</span><a href="#local-6989586621679265385"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilPair"><span class="hs-identifier hs-type">FoilPair</span></a></span><span> </span><span id="local-6989586621679265386"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265386"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621679265387"><span class="annot"><span class="annottext">FoilTerm i
</span><a href="#local-6989586621679265387"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679265388"><span class="annot"><span class="annottext">FoilTerm i
</span><a href="#local-6989586621679265388"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BNFC'Position -&gt; FoilTerm o -&gt; FoilTerm o -&gt; FoilTerm o
forall a (n :: S).
a -&gt; FoilTerm' a n -&gt; FoilTerm' a n -&gt; FoilTerm' a n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#FoilPair"><span class="hs-identifier hs-var">FoilPair</span></a></span><span> </span><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265386"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
forall (o :: S) (i :: S).
Distinct o =&gt;
Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
</span><a href="Language.LambdaPi.Impl.FoilTH.html#substitute"><span class="hs-identifier hs-var">substitute</span></a></span><span> </span><span class="annot"><span class="annottext">Scope o
</span><a href="#local-6989586621679265339"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm i o
</span><a href="#local-6989586621679265340"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm i
</span><a href="#local-6989586621679265387"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
forall (o :: S) (i :: S).
Distinct o =&gt;
Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
</span><a href="Language.LambdaPi.Impl.FoilTH.html#substitute"><span class="hs-identifier hs-var">substitute</span></a></span><span> </span><span class="annot"><span class="annottext">Scope o
</span><a href="#local-6989586621679265339"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm i o
</span><a href="#local-6989586621679265340"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm i
</span><a href="#local-6989586621679265388"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilFirst"><span class="hs-identifier hs-type">FoilFirst</span></a></span><span> </span><span id="local-6989586621679265389"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265389"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621679265390"><span class="annot"><span class="annottext">FoilTerm i
</span><a href="#local-6989586621679265390"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BNFC'Position -&gt; FoilTerm o -&gt; FoilTerm o
forall a (n :: S). a -&gt; FoilTerm' a n -&gt; FoilTerm' a n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#FoilFirst"><span class="hs-identifier hs-var">FoilFirst</span></a></span><span> </span><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265389"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
forall (o :: S) (i :: S).
Distinct o =&gt;
Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
</span><a href="Language.LambdaPi.Impl.FoilTH.html#substitute"><span class="hs-identifier hs-var">substitute</span></a></span><span> </span><span class="annot"><span class="annottext">Scope o
</span><a href="#local-6989586621679265339"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm i o
</span><a href="#local-6989586621679265340"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm i
</span><a href="#local-6989586621679265390"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilSecond"><span class="hs-identifier hs-type">FoilSecond</span></a></span><span> </span><span id="local-6989586621679265391"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265391"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621679265392"><span class="annot"><span class="annottext">FoilTerm i
</span><a href="#local-6989586621679265392"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BNFC'Position -&gt; FoilTerm o -&gt; FoilTerm o
forall a (n :: S). a -&gt; FoilTerm' a n -&gt; FoilTerm' a n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#FoilSecond"><span class="hs-identifier hs-var">FoilSecond</span></a></span><span> </span><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265391"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
forall (o :: S) (i :: S).
Distinct o =&gt;
Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
</span><a href="Language.LambdaPi.Impl.FoilTH.html#substitute"><span class="hs-identifier hs-var">substitute</span></a></span><span> </span><span class="annot"><span class="annottext">Scope o
</span><a href="#local-6989586621679265339"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm i o
</span><a href="#local-6989586621679265340"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm i
</span><a href="#local-6989586621679265392"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilProduct"><span class="hs-identifier hs-type">FoilProduct</span></a></span><span> </span><span id="local-6989586621679265393"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265393"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621679265394"><span class="annot"><span class="annottext">FoilTerm i
</span><a href="#local-6989586621679265394"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679265395"><span class="annot"><span class="annottext">FoilTerm i
</span><a href="#local-6989586621679265395"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BNFC'Position -&gt; FoilTerm o -&gt; FoilTerm o -&gt; FoilTerm o
forall a (n :: S).
a -&gt; FoilTerm' a n -&gt; FoilTerm' a n -&gt; FoilTerm' a n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#FoilProduct"><span class="hs-identifier hs-var">FoilProduct</span></a></span><span> </span><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265393"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
forall (o :: S) (i :: S).
Distinct o =&gt;
Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
</span><a href="Language.LambdaPi.Impl.FoilTH.html#substitute"><span class="hs-identifier hs-var">substitute</span></a></span><span> </span><span class="annot"><span class="annottext">Scope o
</span><a href="#local-6989586621679265339"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm i o
</span><a href="#local-6989586621679265340"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm i
</span><a href="#local-6989586621679265394"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
forall (o :: S) (i :: S).
Distinct o =&gt;
Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
</span><a href="Language.LambdaPi.Impl.FoilTH.html#substitute"><span class="hs-identifier hs-var">substitute</span></a></span><span> </span><span class="annot"><span class="annottext">Scope o
</span><a href="#local-6989586621679265339"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm i o
</span><a href="#local-6989586621679265340"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm i
</span><a href="#local-6989586621679265395"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>    </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilUniverse"><span class="hs-identifier hs-type">FoilUniverse</span></a></span><span> </span><span id="local-6989586621679265396"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265396"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BNFC'Position -&gt; FoilTerm o
forall a (n :: S). a -&gt; FoilTerm' a n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#FoilUniverse"><span class="hs-identifier hs-var">FoilUniverse</span></a></span><span> </span><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265396"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="annot"><span class="hs-comment">-- ** Computation</span></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="annot"><span class="hs-comment">-- | Match a pattern against an expression.</span></span><span>
</span><span id="line-120"></span><span id="local-6989586621679264289"><span id="local-6989586621679264290"><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#matchPattern"><span class="hs-identifier hs-type">matchPattern</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilPattern"><span class="hs-identifier hs-type">FoilPattern</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264289"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264290"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilTerm"><span class="hs-identifier hs-type">FoilTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264289"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Substitution</span></span><span> </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilTerm"><span class="hs-identifier hs-type">FoilTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264290"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264289"><span class="hs-identifier hs-type">n</span></a></span></span></span><span>
</span><span id="line-121"></span><span id="matchPattern"><span class="annot"><span class="annottext">matchPattern :: forall (n :: S) (l :: S).
FoilPattern n l -&gt; FoilTerm n -&gt; Substitution FoilTerm l n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#matchPattern"><span class="hs-identifier hs-var hs-var">matchPattern</span></a></span></span><span> </span><span id="local-6989586621679265399"><span class="annot"><span class="annottext">FoilPattern n l
</span><a href="#local-6989586621679265399"><span class="hs-identifier hs-var">pattern</span></a></span></span><span> </span><span id="local-6989586621679265400"><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265400"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FoilPattern n l
-&gt; FoilTerm n
-&gt; Substitution FoilTerm n n
-&gt; Substitution FoilTerm l n
forall (i :: S) (l :: S) (n :: S).
FoilPattern i l
-&gt; FoilTerm n
-&gt; Substitution FoilTerm i n
-&gt; Substitution FoilTerm l n
</span><a href="#local-6989586621679265401"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">FoilPattern n l
</span><a href="#local-6989586621679265399"><span class="hs-identifier hs-var">pattern</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265400"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm n n
forall (e :: S -&gt; *) (i :: S). InjectName e =&gt; Substitution e i i
</span><span class="hs-identifier hs-var">identitySubst</span></span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-123"></span><span>    </span><span id="local-6989586621679264294"><span id="local-6989586621679264295"><span id="local-6989586621679264296"><span class="annot"><a href="#local-6989586621679265401"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilPattern"><span class="hs-identifier hs-type">FoilPattern</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264294"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264295"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilTerm"><span class="hs-identifier hs-type">FoilTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264296"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Substitution</span></span><span> </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilTerm"><span class="hs-identifier hs-type">FoilTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264294"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264296"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Substitution</span></span><span> </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilTerm"><span class="hs-identifier hs-type">FoilTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264295"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264296"><span class="hs-identifier hs-type">n</span></a></span></span></span></span><span>
</span><span id="line-124"></span><span>    </span><span id="local-6989586621679265401"><span class="annot"><span class="annottext">go :: forall (i :: S) (l :: S) (n :: S).
FoilPattern i l
-&gt; FoilTerm n
-&gt; Substitution FoilTerm i n
-&gt; Substitution FoilTerm l n
</span><a href="#local-6989586621679265401"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilPatternWildcard"><span class="hs-identifier hs-type">FoilPatternWildcard</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">FoilTerm n
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm i n -&gt; Substitution FoilTerm i n
Substitution FoilTerm i n -&gt; Substitution FoilTerm l n
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><a href="#local-6989586621679265401"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilPatternVar"><span class="hs-identifier hs-type">FoilPatternVar</span></a></span><span> </span><span id="local-6989586621679265404"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265404"><span class="hs-identifier hs-var">_loc</span></a></span></span><span> </span><span id="local-6989586621679265405"><span class="annot"><span class="annottext">NameBinder i l
</span><a href="#local-6989586621679265405"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679265406"><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265406"><span class="hs-identifier hs-var">e</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679265407"><span class="annot"><span class="annottext">Substitution FoilTerm i n
</span><a href="#local-6989586621679265407"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm i n
-&gt; NameBinder i l -&gt; FoilTerm n -&gt; Substitution FoilTerm l n
forall (e :: S -&gt; *) (i :: S) (o :: S) (i' :: S).
Substitution e i o -&gt; NameBinder i i' -&gt; e o -&gt; Substitution e i' o
</span><span class="hs-identifier hs-var">addSubst</span></span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm i n
</span><a href="#local-6989586621679265407"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">NameBinder i l
</span><a href="#local-6989586621679265405"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265406"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><a href="#local-6989586621679265401"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilPatternPair"><span class="hs-identifier hs-type">FoilPatternPair</span></a></span><span> </span><span id="local-6989586621679265409"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265409"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621679265410"><span class="annot"><span class="annottext">FoilPattern' BNFC'Position i n2
</span><a href="#local-6989586621679265410"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679265411"><span class="annot"><span class="annottext">FoilPattern' BNFC'Position n2 l
</span><a href="#local-6989586621679265411"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679265412"><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265412"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FoilPattern' BNFC'Position n2 l
-&gt; FoilTerm n
-&gt; Substitution FoilTerm n2 n
-&gt; Substitution FoilTerm l n
forall (i :: S) (l :: S) (n :: S).
FoilPattern i l
-&gt; FoilTerm n
-&gt; Substitution FoilTerm i n
-&gt; Substitution FoilTerm l n
</span><a href="#local-6989586621679265401"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">FoilPattern' BNFC'Position n2 l
</span><a href="#local-6989586621679265411"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BNFC'Position -&gt; FoilTerm n -&gt; FoilTerm n
forall a (n :: S). a -&gt; FoilTerm' a n -&gt; FoilTerm' a n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#FoilSecond"><span class="hs-identifier hs-var">FoilSecond</span></a></span><span> </span><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265409"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265412"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Substitution FoilTerm n2 n -&gt; Substitution FoilTerm l n)
-&gt; (Substitution FoilTerm i n -&gt; Substitution FoilTerm n2 n)
-&gt; Substitution FoilTerm i n
-&gt; Substitution FoilTerm l n
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FoilPattern' BNFC'Position i n2
-&gt; FoilTerm n
-&gt; Substitution FoilTerm i n
-&gt; Substitution FoilTerm n2 n
forall (i :: S) (l :: S) (n :: S).
FoilPattern i l
-&gt; FoilTerm n
-&gt; Substitution FoilTerm i n
-&gt; Substitution FoilTerm l n
</span><a href="#local-6989586621679265401"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">FoilPattern' BNFC'Position i n2
</span><a href="#local-6989586621679265410"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BNFC'Position -&gt; FoilTerm n -&gt; FoilTerm n
forall a (n :: S). a -&gt; FoilTerm' a n -&gt; FoilTerm' a n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#FoilFirst"><span class="hs-identifier hs-var">FoilFirst</span></a></span><span> </span><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265409"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265412"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="annot"><span class="hs-comment">-- | Compute weak head normal form (WHNF).</span></span><span>
</span><span id="line-129"></span><span id="local-6989586621679264307"><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#whnf"><span class="hs-identifier hs-type">whnf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Distinct</span></span><span> </span><span class="annot"><a href="#local-6989586621679264307"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Scope</span></span><span> </span><span class="annot"><a href="#local-6989586621679264307"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilTerm"><span class="hs-identifier hs-type">FoilTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264307"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilTerm"><span class="hs-identifier hs-type">FoilTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679264307"><span class="hs-identifier hs-type">n</span></a></span></span><span>
</span><span id="line-130"></span><span id="whnf"><span class="annot"><span class="annottext">whnf :: forall (n :: S). Distinct n =&gt; Scope n -&gt; FoilTerm n -&gt; FoilTerm n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#whnf"><span class="hs-identifier hs-var hs-var">whnf</span></a></span></span><span> </span><span id="local-6989586621679265419"><span class="annot"><span class="annottext">Scope n
</span><a href="#local-6989586621679265419"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilApp"><span class="hs-identifier hs-type">FoilApp</span></a></span><span> </span><span id="local-6989586621679265420"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265420"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621679265421"><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265421"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679265422"><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265422"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Scope n -&gt; FoilTerm n -&gt; FoilTerm n
forall (n :: S). Distinct n =&gt; Scope n -&gt; FoilTerm n -&gt; FoilTerm n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#whnf"><span class="hs-identifier hs-var">whnf</span></a></span><span> </span><span class="annot"><span class="annottext">Scope n
</span><a href="#local-6989586621679265419"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265421"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-133"></span><span>      </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilLam"><span class="hs-identifier hs-type">FoilLam</span></a></span><span> </span><span id="local-6989586621679265425"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265425"><span class="hs-identifier hs-var">_loc</span></a></span></span><span> </span><span id="local-6989586621679265426"><span class="annot"><span class="annottext">FoilPattern' BNFC'Position n l
</span><a href="#local-6989586621679265426"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilAScopedTerm"><span class="hs-identifier hs-type">FoilAScopedTerm</span></a></span><span> </span><span id="local-6989586621679265427"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265427"><span class="hs-identifier hs-var">_loc'</span></a></span></span><span> </span><span id="local-6989586621679265428"><span class="annot"><span class="annottext">FoilTerm' BNFC'Position l
</span><a href="#local-6989586621679265428"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-134"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679265429"><span class="annot"><span class="annottext">subst :: Substitution FoilTerm l n
</span><a href="#local-6989586621679265429"><span class="hs-identifier hs-var hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FoilPattern' BNFC'Position n l
-&gt; FoilTerm n -&gt; Substitution FoilTerm l n
forall (n :: S) (l :: S).
FoilPattern n l -&gt; FoilTerm n -&gt; Substitution FoilTerm l n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#matchPattern"><span class="hs-identifier hs-var">matchPattern</span></a></span><span> </span><span class="annot"><span class="annottext">FoilPattern' BNFC'Position n l
</span><a href="#local-6989586621679265426"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265422"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-135"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Scope n -&gt; FoilTerm n -&gt; FoilTerm n
forall (n :: S). Distinct n =&gt; Scope n -&gt; FoilTerm n -&gt; FoilTerm n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#whnf"><span class="hs-identifier hs-var">whnf</span></a></span><span> </span><span class="annot"><span class="annottext">Scope n
</span><a href="#local-6989586621679265419"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope n
-&gt; Substitution FoilTerm l n
-&gt; FoilTerm' BNFC'Position l
-&gt; FoilTerm n
forall (o :: S) (i :: S).
Distinct o =&gt;
Scope o -&gt; Substitution FoilTerm i o -&gt; FoilTerm i -&gt; FoilTerm o
</span><a href="Language.LambdaPi.Impl.FoilTH.html#substitute"><span class="hs-identifier hs-var">substitute</span></a></span><span> </span><span class="annot"><span class="annottext">Scope n
</span><a href="#local-6989586621679265419"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution FoilTerm l n
</span><a href="#local-6989586621679265429"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm' BNFC'Position l
</span><a href="#local-6989586621679265428"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>      </span><span id="local-6989586621679265430"><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265430"><span class="hs-identifier hs-var">f'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BNFC'Position -&gt; FoilTerm n -&gt; FoilTerm n -&gt; FoilTerm n
forall a (n :: S).
a -&gt; FoilTerm' a n -&gt; FoilTerm' a n -&gt; FoilTerm' a n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#FoilApp"><span class="hs-identifier hs-var">FoilApp</span></a></span><span> </span><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265420"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265430"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265422"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilFirst"><span class="hs-identifier hs-type">FoilFirst</span></a></span><span> </span><span id="local-6989586621679265431"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265431"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621679265432"><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265432"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Scope n -&gt; FoilTerm n -&gt; FoilTerm n
forall (n :: S). Distinct n =&gt; Scope n -&gt; FoilTerm n -&gt; FoilTerm n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#whnf"><span class="hs-identifier hs-var">whnf</span></a></span><span> </span><span class="annot"><span class="annottext">Scope n
</span><a href="#local-6989586621679265419"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265432"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-139"></span><span>      </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilPair"><span class="hs-identifier hs-type">FoilPair</span></a></span><span> </span><span id="local-6989586621679265433"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265433"><span class="hs-identifier hs-var">_loc</span></a></span></span><span> </span><span id="local-6989586621679265434"><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265434"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679265435"><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265435"><span class="hs-identifier hs-var">_r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Scope n -&gt; FoilTerm n -&gt; FoilTerm n
forall (n :: S). Distinct n =&gt; Scope n -&gt; FoilTerm n -&gt; FoilTerm n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#whnf"><span class="hs-identifier hs-var">whnf</span></a></span><span> </span><span class="annot"><span class="annottext">Scope n
</span><a href="#local-6989586621679265419"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265434"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-140"></span><span>      </span><span id="local-6989586621679265436"><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265436"><span class="hs-identifier hs-var">t'</span></a></span></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BNFC'Position -&gt; FoilTerm n -&gt; FoilTerm n
forall a (n :: S). a -&gt; FoilTerm' a n -&gt; FoilTerm' a n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#FoilFirst"><span class="hs-identifier hs-var">FoilFirst</span></a></span><span> </span><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265431"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265436"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-141"></span><span>  </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilSecond"><span class="hs-identifier hs-type">FoilSecond</span></a></span><span> </span><span id="local-6989586621679265437"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265437"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621679265438"><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265438"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Scope n -&gt; FoilTerm n -&gt; FoilTerm n
forall (n :: S). Distinct n =&gt; Scope n -&gt; FoilTerm n -&gt; FoilTerm n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#whnf"><span class="hs-identifier hs-var">whnf</span></a></span><span> </span><span class="annot"><span class="annottext">Scope n
</span><a href="#local-6989586621679265419"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265438"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-143"></span><span>      </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilPair"><span class="hs-identifier hs-type">FoilPair</span></a></span><span> </span><span id="local-6989586621679265439"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265439"><span class="hs-identifier hs-var">_loc</span></a></span></span><span> </span><span id="local-6989586621679265440"><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265440"><span class="hs-identifier hs-var">_l</span></a></span></span><span> </span><span id="local-6989586621679265441"><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265441"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Scope n -&gt; FoilTerm n -&gt; FoilTerm n
forall (n :: S). Distinct n =&gt; Scope n -&gt; FoilTerm n -&gt; FoilTerm n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#whnf"><span class="hs-identifier hs-var">whnf</span></a></span><span> </span><span class="annot"><span class="annottext">Scope n
</span><a href="#local-6989586621679265419"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265441"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-144"></span><span>      </span><span id="local-6989586621679265442"><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265442"><span class="hs-identifier hs-var">t'</span></a></span></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BNFC'Position -&gt; FoilTerm n -&gt; FoilTerm n
forall a (n :: S). a -&gt; FoilTerm' a n -&gt; FoilTerm' a n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#FoilSecond"><span class="hs-identifier hs-var">FoilSecond</span></a></span><span> </span><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265437"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265442"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-145"></span><span>  </span><span id="local-6989586621679265443"><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265443"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FoilTerm n
</span><a href="#local-6989586621679265443"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="annot"><span class="hs-comment">-- ** Interpreter</span></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="annot"><span class="hs-comment">-- | Interpret a \(\lambda\Pi\) command.</span></span><span>
</span><span id="line-150"></span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#interpretCommand"><span class="hs-identifier hs-type">interpretCommand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LambdaPi.Syntax.Abs.html#Command"><span class="hs-identifier hs-type">Raw.Command</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span id="interpretCommand"><span class="annot"><span class="annottext">interpretCommand :: Command -&gt; IO ()
</span><a href="Language.LambdaPi.Impl.FoilTH.html#interpretCommand"><span class="hs-identifier hs-var hs-var">interpretCommand</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LambdaPi.Syntax.Abs.html#CommandCompute"><span class="hs-identifier hs-type">Raw.CommandCompute</span></a></span><span> </span><span id="local-6989586621679265446"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265446"><span class="hs-identifier hs-var">_loc</span></a></span></span><span> </span><span id="local-6989586621679265447"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621679265447"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span id="local-6989586621679265448"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621679265448"><span class="hs-identifier hs-var">_type</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-152"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  &#8614; &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">FoilTerm 'VoidS -&gt; String
</span><a href="Language.LambdaPi.Impl.FoilTH.html#printFoilTerm"><span class="hs-identifier hs-var">printFoilTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope 'VoidS -&gt; FoilTerm 'VoidS -&gt; FoilTerm 'VoidS
forall (n :: S). Distinct n =&gt; Scope n -&gt; FoilTerm n -&gt; FoilTerm n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#whnf"><span class="hs-identifier hs-var">whnf</span></a></span><span> </span><span class="annot"><span class="annottext">Scope 'VoidS
</span><span class="hs-identifier hs-var">emptyScope</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scope 'VoidS
-&gt; Map VarIdent (Name 'VoidS) -&gt; Term -&gt; FoilTerm 'VoidS
forall (n :: S) a.
Distinct n =&gt;
Scope n -&gt; Map VarIdent (Name n) -&gt; Term' a -&gt; FoilTerm' a n
</span><a href="Language.LambdaPi.Impl.FoilTH.html#toFoilTerm%27"><span class="hs-identifier hs-var">toFoilTerm'</span></a></span><span> </span><span class="annot"><span class="annottext">Scope 'VoidS
</span><span class="hs-identifier hs-var">emptyScope</span></span><span> </span><span class="annot"><span class="annottext">Map VarIdent (Name 'VoidS)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621679265447"><span class="hs-identifier hs-var">term</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span class="hs-comment">-- #TODO: add typeCheck</span><span>
</span><span id="line-154"></span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#interpretCommand"><span class="hs-identifier hs-var">interpretCommand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LambdaPi.Syntax.Abs.html#CommandCheck"><span class="hs-identifier hs-type">Raw.CommandCheck</span></a></span><span> </span><span id="local-6989586621679265454"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265454"><span class="hs-identifier hs-var">_loc</span></a></span></span><span> </span><span id="local-6989586621679265455"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621679265455"><span class="hs-identifier hs-var">_term</span></a></span></span><span> </span><span id="local-6989586621679265456"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621679265456"><span class="hs-identifier hs-var">_type</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-155"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Not yet implemented&quot;</span></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="annot"><span class="hs-comment">-- | Interpret a \(\lambda\Pi\) program.</span></span><span>
</span><span id="line-158"></span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#interpretProgram"><span class="hs-identifier hs-type">interpretProgram</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LambdaPi.Syntax.Abs.html#Program"><span class="hs-identifier hs-type">Raw.Program</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span id="interpretProgram"><span class="annot"><span class="annottext">interpretProgram :: Program -&gt; IO ()
</span><a href="Language.LambdaPi.Impl.FoilTH.html#interpretProgram"><span class="hs-identifier hs-var hs-var">interpretProgram</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LambdaPi.Syntax.Abs.html#AProgram"><span class="hs-identifier hs-type">Raw.AProgram</span></a></span><span> </span><span id="local-6989586621679265459"><span class="annot"><span class="annottext">BNFC'Position
</span><a href="#local-6989586621679265459"><span class="hs-identifier hs-var">_loc</span></a></span></span><span> </span><span id="local-6989586621679265460"><span class="annot"><span class="annottext">[Command]
</span><a href="#local-6989586621679265460"><span class="hs-identifier hs-var">typedTerms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Command -&gt; IO ()) -&gt; [Command] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Command -&gt; IO ()
</span><a href="Language.LambdaPi.Impl.FoilTH.html#interpretCommand"><span class="hs-identifier hs-var">interpretCommand</span></a></span><span> </span><span class="annot"><span class="annottext">[Command]
</span><a href="#local-6989586621679265460"><span class="hs-identifier hs-var">typedTerms</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-comment">-- | Default interpreter program.</span><span>
</span><span id="line-162"></span><span class="hs-comment">-- Reads a \(\lambda\Pi\) program from the standard input and runs the commands.</span><span>
</span><span id="line-163"></span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#defaultMain"><span class="hs-identifier hs-type">defaultMain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span id="defaultMain"><span class="annot"><span class="annottext">defaultMain :: IO ()
</span><a href="Language.LambdaPi.Impl.FoilTH.html#defaultMain"><span class="hs-identifier hs-var hs-var">defaultMain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-165"></span><span>  </span><span id="local-6989586621679265462"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679265462"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String
</span><span class="hs-identifier hs-var">getContents</span></span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Token] -&gt; Err Program
</span><a href="Language.LambdaPi.Syntax.Par.html#pProgram"><span class="hs-identifier hs-var">Raw.pProgram</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; [Token] -&gt; [Token]
</span><a href="Language.LambdaPi.Syntax.Layout.html#resolveLayout"><span class="hs-identifier hs-var">Raw.resolveLayout</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [Token]
</span><a href="Language.LambdaPi.Syntax.Lex.html#tokens"><span class="hs-identifier hs-var">Raw.tokens</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679265462"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-167"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679265467"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679265467"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-168"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679265467"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-169"></span><span>      </span><span class="annot"><span class="annottext">IO ()
forall a. IO a
</span><span class="hs-identifier hs-var">exitFailure</span></span><span>
</span><span id="line-170"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679265468"><span class="annot"><span class="annottext">Program
</span><a href="#local-6989586621679265468"><span class="hs-identifier hs-var">program</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Program -&gt; IO ()
</span><a href="Language.LambdaPi.Impl.FoilTH.html#interpretProgram"><span class="hs-identifier hs-var">interpretProgram</span></a></span><span> </span><span class="annot"><span class="annottext">Program
</span><a href="#local-6989586621679265468"><span class="hs-identifier hs-var">program</span></a></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="annot"><span class="hs-comment">-- ** Pretty-printing</span></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-comment">-- | Pretty-print a /closed/ scode-safe \(\lambda\Pi\)-term</span><span>
</span><span id="line-175"></span><span class="hs-comment">-- using BNFC-generated printer (via 'Raw.Term').</span><span>
</span><span id="line-176"></span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#printFoilTerm"><span class="hs-identifier hs-type">printFoilTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.LambdaPi.Impl.FoilTH.html#FoilTerm"><span class="hs-identifier hs-type">FoilTerm</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">VoidS</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-177"></span><span id="printFoilTerm"><span class="annot"><span class="annottext">printFoilTerm :: FoilTerm 'VoidS -&gt; String
</span><a href="Language.LambdaPi.Impl.FoilTH.html#printFoilTerm"><span class="hs-identifier hs-var hs-var">printFoilTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term -&gt; String
forall a. Print a =&gt; a -&gt; String
</span><a href="Language.LambdaPi.Syntax.Print.html#printTree"><span class="hs-identifier hs-var">Raw.printTree</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; String)
-&gt; (FoilTerm 'VoidS -&gt; Term) -&gt; FoilTerm 'VoidS -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[VarIdent] -&gt; FoilTerm 'VoidS -&gt; Term
</span><a href="Language.LambdaPi.Impl.FoilTH.html#fromFoilTermClosed"><span class="hs-identifier hs-var">fromFoilTermClosed</span></a></span><span>
</span><span id="line-178"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; VarIdent
</span><a href="Language.LambdaPi.Syntax.Abs.html#VarIdent"><span class="hs-identifier hs-var">Raw.VarIdent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;x&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679265472"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679265472"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679265472"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-179"></span></pre></body></html>